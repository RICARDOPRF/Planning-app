<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Duoplanning ‚Äî v4.2 (Login com t√≠tulo + Idiomas)</title>
  <meta name="color-scheme" content="dark light">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <audio id="audioWin" preload="auto">
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_0b6ce6218f.mp3?filename=success-fanfare-trumpets-6185.mp3" type="audio/mpeg">
  </audio>
  <style>
    :root{--bg:#0f1115;--text:#e9eef7;--muted:#a7b1c2;--primary:#3aa0ff;--accent:#ffb020;--success:#27c081;--danger:#ff5d5d;--panel:#161c24;--card:#141a22;--border:#273046;--locked:#6b7280}
    *{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font:500 15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .wrap{max-width:1120px;margin:0 auto;padding:24px}
    h1,h2,h3{margin:0 0 12px}
    .brand{display:flex;justify-content:center;margin-bottom:16px}
    .brand h1{font-size:34px;letter-spacing:.3px}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.1)}
    .grid{display:grid;gap:12px}.grid.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid.cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#111720;color:var(--text);cursor:pointer;transition:transform .15s ease}
    .btn.primary{background:var(--primary);color:#05131e;border:none}.btn.ghost{background:transparent}.btn:disabled{opacity:.6}
    .meta{color:var(--muted);font-size:13px}.badge{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:#05131e;background:var(--accent);padding:4px 8px;border-radius:999px}
    .xpbar{height:10px;background:#0b111a;border:1px solid var(--border);border-radius:999px;overflow:hidden}.xpbar>i{display:block;height:100%;background:linear-gradient(90deg,var(--success),#6ee7b7)}
    .mod{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px;border:1px solid var(--border);border-radius:12px;background:#101723}
    .mod .left{display:flex;align-items:center;gap:10px}.mod .lvl{font-size:20px}.lock{opacity:.85;color:var(--locked)}
    .hidden{display:none !important}.row{display:flex;gap:12px;flex-wrap:wrap}
    input[type="text"],select{background:#0f1520;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid var(--border);border-radius:999px;background:#0c131d}
    .toast{position:fixed;right:16px;bottom:16px;background:#0c1a13;border:1px solid #124c2e;color:#b9f6ca;padding:12px 14px;border-radius:12px;box-shadow:0 10px 28px rgba(0,0,0,.35);display:none}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:18px;animation:fadeIn .2s ease;z-index:20}
    .overlay .sheet{max-width:860px;width:100%;background:var(--panel);border:1px solid var(--border);border-radius:18px;box-shadow:0 24px 64px rgba(0,0,0,.5);overflow:hidden}
    .sheet .head{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border);background:#0f1722}
    .sheet .body{padding:16px}.q{font-size:17px;margin-bottom:10px}.opts{display:grid;gap:10px}
    .opt{padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#0d1420;cursor:pointer;transition:background .2s ease,border-color .2s ease}
    .opt.correct{border-color:#1f9d6b;background:#0b1712}.opt.wrong{border-color:#8b1d30;background:#190f12}
    .exp{border-left:3px solid var(--accent);padding:8px 12px;margin-top:10px;background:#0f1622}
    .foot{display:flex;align-items:center;justify-content:space-between;margin-top:14px}
    .view{opacity:0;transform:translateY(8px);transition:opacity .25s ease,transform .25s ease}.view.show{opacity:1;transform:translateY(0)}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
  </style>

  <!-- Firebase (compat) for easy inline usage) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
</head>
<body>
<div class="wrap">

  <!-- Top bar (oculto no login) -->
  <div id="topBar" class="row hidden" style="align-items:center;justify-content:space-between;margin-bottom:16px">
    <div class="row" style="align-items:center">
      <h1>Duoplanning</h1>
    </div>
    <div class="row">
      <button id="btnConfig" class="btn ghost">‚öôÔ∏è <span class="meta" style="font-size:14px" data-i18n="settings">Configura√ß√µes</span></button>
      <button id="btnLogout" class="btn ghost hidden" data-i18n="logout">Sair</button>
    </div>
  </div>

  <!-- BRAND no login -->
  <div id="brandLogin" class="brand"><h1>Duoplanning</h1></div>

  <!-- Login -->
  <section id="viewLogin" class="panel view show">
    <h2 data-i18n="login_title">Entrar</h2>
    <p class="meta" data-i18n="login_tip">Digite seu nome para come√ßar sua trilha.</p>
    <div class="row">
      <input id="inpName" type="text" placeholder="Seu nome" style="min-width:260px" />
      <button id="btnLogin" class="btn primary" data-i18n="start">Come√ßar</button>
    </div>
    <div class="meta" style="margin-top:10px" data-i18n="login_hint">Voc√™ come√ßar√° no n√≠vel T√©cnico e desbloqueia os demais por XP.</div>
  </section>

  <!-- Dashboard -->
  <section id="viewDash" class="hidden view">
    <div class="grid cols-3">
      <div class="panel">
        <h3 id="hello">Ol√°, Jogador</h3>
        <div class="meta" id="roleMini">T√©cnico ‚Äî Domina o b√°sico do LPS</div>
        <div style="margin:10px 0 6px;display:flex;justify-content:space-between;align-items:center">
          <div class="meta"><span data-i18n="xp">XP</span>: <b id="xpNow">0</b> / <span id="xpGoal">1000</span></div>
          <div class="pill"><span id="streak">üî• 0</span><span class="meta" data-i18n="streak">streak</span></div>
        </div>
        <div class="xpbar"><i id="xpBar" style="width:0%"></i></div>
        <div class="row" style="margin-top:12px">
          <div class="pill">‚ö° <b id="energy">3</b> <span class="meta" data-i18n="energy">energia</span></div>
          <div class="pill">üèÜ <span data-i18n="local_rank">Rank local</span>: <b id="rankMe">#1</b></div>
        </div>
      </div>

      <div class="panel">
        <h3 data-i18n="missions_hdr">Miss√µes</h3>
        <div class="row">
          <div class="pill" id="missionDailyPill">üéØ <b data-i18n="daily">Dia</b>: <span data-i18n="daily_desc">Refa√ßa um quiz 100% (+20XP)</span></div>
          <div class="pill" id="missionWeekPill">üìÖ <b data-i18n="week">Semana</b>: <span data-i18n="week_desc">Concluir 3 m√≥dulos (+100XP)</span> <span class="meta" id="weekProg">(0/3)</span></div>
        </div>
        <div class="meta" style="margin-top:10px" data-i18n="week_progress">Progresso semanal:</div>
        <div class="xpbar"><i id="weekBar" style="width:0%"></i></div>
      </div>

      <div class="panel">
        <h3 data-i18n="rank_hdr">Ranking (local)</h3>
        <div id="rankList" class="grid"></div>
      </div>
    </div>

    <div class="panel" style="margin-top:14px">
      <div class="row" style="align-items:center;justify-content:space-between">
        <h3 data-i18n="modules_hdr">M√≥dulos</h3>
        <div class="pill" id="levelNowPill">üë∑ T√©cnico</div>
      </div>
      <div class="meta" style="margin:6px 0" data-i18n="modules_hint">M√≥dulos de outros n√≠veis aparecem com cadeado üîí. Ganhe XP para desbloquear!</div>
      <div id="mods" class="grid cols-4" style="margin-top:12px"></div>
    </div>
  </section>

</div>

<!-- Quiz Overlay -->
<div id="quizOverlay" class="overlay">
  <div class="sheet">
    <div class="head">
      <div id="quizTitle">Quiz</div>
      <button id="btnCloseQuiz" class="btn ghost" data-i18n="close">Fechar</button>
    </div>
    <div class="body">
      <div class="q" id="qText">Pergunta</div>
      <div class="opts" id="qOpts"></div>
      <div id="qExplain" class="exp hidden"></div>
      <div class="foot">
        <div class="meta"><span id="qNum">1</span>/10</div>
        <button id="btnNext" class="btn primary" data-i18n="next">Avan√ßar</button>
      </div>
    </div>
  </div>
</div>

<!-- Config Overlay (agora com Idioma) -->
<div id="cfgOverlay" class="overlay">
  <div class="sheet">
    <div class="head">
      <div>‚öôÔ∏è <b data-i18n="settings">Configura√ß√µes</b></div>
      <button id="btnCloseCfg" class="btn ghost" data-i18n="close">Fechar</button>
    </div>
    <div class="body">
      <div class="grid cols-3">
        <div class="panel">
          <h3 data-i18n="appearance">Apar√™ncia</h3>
          <div class="row" style="margin-top:8px">
            <label class="meta" for="selTheme" data-i18n="theme">Tema</label>
            <select id="selTheme">
              <option value="dark" data-i18n="theme_dark">Escuro</option>
              <option value="light" data-i18n="theme_light">Claro</option>
              <option value="auto" data-i18n="theme_auto">Autom√°tico</option>
            </select>
          </div>
        </div>
        <div class="panel">
          <h3 data-i18n="language">Idioma</h3>
          <div class="row" style="margin-top:8px">
            <select id="langSel">
              <option value="pt">Portugu√™s</option>
              <option value="en">English</option>
              <option value="es">Espa√±ol</option>
            </select>
          </div>
        </div>
        <div class="panel">
          <h3 data-i18n="effects">Efeitos</h3>
          <div class="row" style="margin-top:8px">
            <label><input type="checkbox" id="chkSound" /> <span class="meta" data-i18n="sound">Som de vit√≥ria</span></label>
          </div>
          <div class="row">
            <label><input type="checkbox" id="chkConfetti" /> <span class="meta" data-i18n="confetti">Confete</span></label>
          </div>
        </div>
      </div>
      <div class="panel" style="margin-top:12px">
        <h3 data-i18n="danger_zone">Zona de risco</h3>
        <button id="btnReset" class="btn" style="margin-top:8px;background:#1f2937" data-i18n="reset">Resetar progresso</button>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast">Salvo</div>

<script>
// ====== I18N (PT/EN/ES) ======
const I18N = {
  pt: {login_title:"Entrar", login_tip:"Digite seu nome para come√ßar sua trilha.", login_hint:"Voc√™ come√ßar√° no n√≠vel T√©cnico e desbloqueia os demais por XP.", start:"Come√ßar", xp:"XP", streak:"streak", energy:"energia", local_rank:"Rank local", missions_hdr:"Miss√µes", daily:"Dia", daily_desc:"Refa√ßa um quiz 100% (+20XP)", week:"Semana", week_desc:"Concluir 3 m√≥dulos (+100XP)", week_progress:"Progresso semanal:", rank_hdr:"Ranking (local)", modules_hdr:"M√≥dulos", modules_hint:"M√≥dulos de outros n√≠veis aparecem com cadeado üîí. Ganhe XP para desbloquear!", close:"Fechar", next:"Avan√ßar", welcome:"Bem-vindo(a)!", saved:"Salvo", module_done:"M√≥dulo #{id} conclu√≠do: {score}/10", mission_daily_done:"Miss√£o do Dia conclu√≠da! +20XP", mission_week_done:"Miss√£o da Semana conclu√≠da! +100XP", settings:"Configura√ß√µes", appearance:"Apar√™ncia", theme:"Tema", theme_dark:"Escuro", theme_light:"Claro", theme_auto:"Autom√°tico", language:"Idioma", effects:"Efeitos", sound:"Som de vit√≥ria", confetti:"Confete", danger_zone:"Zona de risco", reset:"Resetar progresso", logout:"Sair"},
  en: {login_title:"Sign in", login_tip:"Type your name to start your path.", login_hint:"You will start at the Technician level and unlock the others with XP.", start:"Start", xp:"XP", streak:"streak", energy:"energy", local_rank:"Local rank", missions_hdr:"Missions", daily:"Daily", daily_desc:"Retake a quiz with 100% (+20XP)", week:"Weekly", week_desc:"Complete 3 modules (+100XP)", week_progress:"Weekly progress:", rank_hdr:"Ranking (local)", modules_hdr:"Modules", modules_hint:"Modules from other levels show a üîí. Earn XP to unlock!", close:"Close", next:"Next", welcome:"Welcome!", saved:"Saved", module_done:"Module #{id} finished: {score}/10", mission_daily_done:"Daily Mission completed! +20XP", mission_week_done:"Weekly Mission completed! +100XP", settings:"Settings", appearance:"Appearance", theme:"Theme", theme_dark:"Dark", theme_light:"Light", theme_auto:"Auto", language:"Language", effects:"Effects", sound:"Victory sound", confetti:"Confetti", danger_zone:"Danger zone", reset:"Reset progress", logout:"Logout"},
  es: {login_title:"Iniciar sesi√≥n", login_tip:"Escribe tu nombre para comenzar tu ruta.", login_hint:"Comenzar√°s en el nivel T√©cnico y desbloquear√°s los dem√°s con XP.", start:"Comenzar", xp:"XP", streak:"racha", energy:"energ√≠a", local_rank:"Ranking local", missions_hdr:"Misiones", daily:"D√≠a", daily_desc:"Repite un quiz con 100% (+20XP)", week:"Semana", week_desc:"Completar 3 m√≥dulos (+100XP)", week_progress:"Progreso semanal:", rank_hdr:"Ranking (local)", modules_hdr:"M√≥dulos", modules_hint:"Los m√≥dulos de otros niveles se muestran con candado üîí. ¬°Gana XP para desbloquearlos!", close:"Cerrar", next:"Siguiente", welcome:"¬°Bienvenido(a)!", saved:"Guardado", module_done:"M√≥dulo #{id} completado: {score}/10", mission_daily_done:"¬°Misi√≥n diaria completada! +20XP", mission_week_done:"¬°Misi√≥n semanal completada! +100XP", settings:"Configuraci√≥n", appearance:"Apariencia", theme:"Tema", theme_dark:"Oscuro", theme_light:"Claro", theme_auto:"Autom√°tico", language:"Idioma", effects:"Efectos", sound:"Sonido de victoria", confetti:"Confeti", danger_zone:"Zona de riesgo", reset:"Restablecer progreso", logout:"Salir"}
};
let lang = localStorage.getItem("duoplanning.lang") || "pt";
function t(key, vars={}){
  const dict = I18N[lang] || I18N.pt; let s = dict[key] || key;
  Object.entries(vars).forEach(([k,v])=>{ s = s.replaceAll("{"+k+"}", v); });
  return s;
}
function applyI18n() {
  const dict = I18N[lang] || I18N.pt;
  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.getAttribute("data-i18n");
    if (dict[key]) el.textContent = dict[key];
  });
  const ls = document.getElementById("langSel"); if (ls) ls.value = lang;
  document.documentElement.lang = lang === "pt" ? "pt-BR" : (lang === "es" ? "es-ES" : "en-US");
}

// ====== Settings (tema/som/confete) ======
const SETTINGS_KEY = "duoplanning.v42.settings";
let Settings = JSON.parse(localStorage.getItem(SETTINGS_KEY) || "null") || { theme:"dark", sound:true, confetti:true };
function saveSettings(){ localStorage.setItem(SETTINGS_KEY, JSON.stringify(Settings)); }
function applyTheme(){
  let theme = Settings.theme;
  if (theme==="auto"){ const prefersLight = window.matchMedia && window.matchMedia("(prefers-color-scheme: light)").matches; theme = prefersLight?"light":"dark"; }
  document.documentElement.setAttribute("data-theme", theme==="light"?"light":"dark");
}

// ====== Data ======
const LEVELS=[
  {id:"Tecnico",name:"T√©cnico",icon:"üë∑‚Äç‚ôÇÔ∏è",minXP:0,nextXP:1000,desc:"Domina o b√°sico do LPS"},
  {id:"Analista",name:"Analista",icon:"üë®‚Äçüíª",minXP:1000,nextXP:3000,desc:"Organiza cronogramas e indicadores"},
  {id:"Especialista",name:"Especialista",icon:"üë®‚Äçüîß",minXP:3000,nextXP:6000,desc:"Integra Engenharia e Obra"},
  {id:"Gerente",name:"Gerente/Diretor",icon:"üëî",minXP:6000,nextXP:10000,desc:"Lidera com Lean e Performance"},
  {id:"Visionario",name:"Vision√°rio",icon:"üîÆ",minXP:10000,nextXP:Infinity,desc:"Inova com IA, BIM e 5D"}
];
const XP_PER_LEVEL={Tecnico:30,Analista:40,Especialista:50,Gerente:60,Visionario:80};
const MODULES=[
  {id:1,nivel:"T√©cnico",titulo:"LPS ‚Äì Last Planner System"},
  {id:2,nivel:"T√©cnico",titulo:"Cronograma"},
  {id:3,nivel:"T√©cnico",titulo:"Programa√ß√£o Semanal (WWP)"},
  {id:4,nivel:"T√©cnico",titulo:"EAP / AWP"},
  {id:5,nivel:"T√©cnico",titulo:"Folha Tarefa"},
  {id:6,nivel:"T√©cnico",titulo:"Produtos Not√°veis"},
  {id:7,nivel:"T√©cnico",titulo:"Painel de Bordo"},
  {id:8,nivel:"T√©cnico",titulo:"Rundown / Curva S"},
  {id:9,nivel:"T√©cnico",titulo:"√çndices e Produtividade"},
  {id:10,nivel:"T√©cnico",titulo:"Reuni√µes Lean"},
  {id:11,nivel:"T√©cnico",titulo:"Restri√ß√µes"},
  {id:12,nivel:"T√©cnico",titulo:"Waste Time"},

  {id:13,nivel:"Analista",titulo:"Linha de Produ√ß√£o na Obra ‚Äî Estrat√©gias da Ind√∫stria no Campo"},
  {id:14,nivel:"Analista",titulo:"Produtos Not√°veis na Pr√°tica ‚Äî Super M√≥dulo"},
  {id:15,nivel:"Analista",titulo:"Folha-Tarefa & Ader√™ncia Di√°ria (PPC)"},
  {id:16,nivel:"Analista",titulo:"PPC, ICP e IPP ‚Äî Diferen√ßas e Aplica√ß√µes"},
  {id:17,nivel:"Analista",titulo:"Programa√ß√£o Semanal (WWP) Avan√ßada"},
  {id:18,nivel:"Analista",titulo:"Gest√£o de Restri√ß√µes Avan√ßada"},
  {id:19,nivel:"Analista",titulo:"Painel de Bordo ‚Äî KPIs e Decis√£o"},
  {id:20,nivel:"Analista",titulo:"Curva S & Rundown ‚Äî Leitura e A√ß√£o"},
  {id:21,nivel:"Analista",titulo:"Linha de Balan√ßo e Takt Time"},
  {id:22,nivel:"Analista",titulo:"Controle de Materiais ‚Äî Tele Materiais"},

  {id:23,nivel:"Especialista",titulo:"Integra√ß√£o Engenharia‚ÄìPlanejamento"},
  {id:24,nivel:"Especialista",titulo:"AWP em Campo ‚Äî EWP/CWP/IWP"},
  {id:25,nivel:"Especialista",titulo:"Cronograma F√≠sico-Financeiro (Recursos & Custos)"},
  {id:26,nivel:"Especialista",titulo:"Medi√ß√£o e Crit√©rios ‚Äî Pesos e Avan√ßo"},
  {id:27,nivel:"Especialista",titulo:"Comissionamento ‚Äî Planilha Gerencial"},
  {id:28,nivel:"Especialista",titulo:"Programa√ß√£o por √çndices e Efetivo"},
  {id:29,nivel:"Especialista",titulo:"Gest√£o Visual de Obra (Quadros)"},
  {id:30,nivel:"Especialista",titulo:"I√ßamentos com Guindaste ‚Äî Planejamento e Interfer√™ncias"},
  {id:31,nivel:"Especialista",titulo:"Transfer√™ncia de Obra ‚Äî Entrada R√°pida (Situa√ß√µes Reais)"},
  {id:32,nivel:"Especialista",titulo:"SIMOVA ‚Äî Rotinas de Campo e Integra√ß√£o"},

  {id:33,nivel:"Gerente/Diretor",titulo:"Lideran√ßa Lean & Performance"},
  {id:34,nivel:"Gerente/Diretor",titulo:"Curva S e Rundown: Visualizando a Performance"},
  {id:35,nivel:"Gerente/Diretor",titulo:"AWP com Cronograma Integrado ‚Äî Recursos e Custos"},
  {id:36,nivel:"Gerente/Diretor",titulo:"Gest√£o de Portf√≥lio e Prioridades"},
  {id:37,nivel:"Gerente/Diretor",titulo:"Estrat√©gias de Contrata√ß√£o e Medi√ß√£o"},
  {id:38,nivel:"Gerente/Diretor",titulo:"Obeya ‚Äî Governan√ßa de Reuni√µes e Decis√µes"},

  {id:39,nivel:"Vision√°rio",titulo:"BIM 4D/5D ‚Äî Planejamento Integrado"},
  {id:40,nivel:"Vision√°rio",titulo:"IA & Power BI ‚Äî Simula√ß√µes em Tempo Real"}
];
const QUIZZES={};
QUIZZES[1]=[{q:"Qual √© o objetivo principal do LPS?",opts:["Conectar planejamento √† execu√ß√£o com compromisso real da equipe","Somente registrar tarefas no cronograma","Delegar o planejamento ao PMO"],ok:0,exp:"LPS alinha plano e execu√ß√£o por meio de compromissos confi√°veis e remo√ß√£o de restri√ß√µes."},{q:"PPC (Percent Plan Complete) mede:",opts:["Ader√™ncia ao plano semanal","Produtividade de HH","Acur√°cia de custos"],ok:0,exp:"PPC √© % de tarefas planejadas conclu√≠das na semana."},{q:"No LPS, as reuni√µes de WWP servem para:",opts:["Planejar tarefas execut√°veis e tratar restri√ß√µes","Aprovar aditivos","Revisar or√ßamento anual"],ok:0,exp:"WWP prepara o trabalho removendo restri√ß√µes e negociando compromissos."},{q:"Pull Planning √©:",opts:["Planejar de tr√°s pra frente por marcos","Planejar s√≥ com o passado","Planejar por recursos financeiros"],ok:0,exp:"Inicia dos marcos e puxa entregas necess√°rias para atingi-los."},{q:"Indicador de causa de n√£o cumprimento:",opts:["Motivos de falha (causas)","Horas extras","Volume de compras"],ok:0,exp:"Registrar causas (material, acesso, projeto, clima...) fecha o ciclo PDCA."},{q:"Para elevar o PPC de forma sustent√°vel:",opts:["Tratar restri√ß√µes no lookahead","Aumentar press√£o por meta","Reduzir escopo sem registrar"],ok:0,exp:"Olhar √† frente e remover restri√ß√µes aumenta confiabilidade."},{q:"No LPS, ‚Äòtarefa pronta para executar‚Äô significa:",opts:["Sem restri√ß√µes de material, projeto, frente e seguran√ßa","Apenas com material no canteiro","Somente com equipe alocada"],ok:0,exp:"Crit√©rios de prontid√£o devem ser atendidos antes do compromisso."},{q:"O papel da Supervis√£o no LPS:",opts:["Assumir compromissos e gerir varia√ß√µes","Somente reportar ao planejamento","Aprovar notas fiscais"],ok:0,exp:"Compromisso √© de quem executa; supervis√£o √© chave."},{q:"ICP e IPP est√£o relacionados a:",opts:["Confiabilidade do plano e prontid√£o","Custo unit√°rio","Produtividade de guindaste"],ok:0,exp:"ICP mede causas de n√£o cumprimento; IPP mede prontid√£o."},{q:"Resultado esperado com LPS maduro:",opts:["Menos variabilidade e mais fluxo","Mais burocracia","Menos transpar√™ncia"],ok:0,exp:"LPS estabiliza o sistema e aumenta previsibilidade."}];
QUIZZES[2]=[{q:"Cronograma n√≠vel 1-2 normalmente representa:",opts:["Macro fases e marcos","Recursos hora a hora","Ordens de compra"],ok:0,exp:"N√≠veis altos mostram vis√£o executiva de fases e marcos."},{q:"Caminho Cr√≠tico √©:",opts:["Sequ√™ncia de atividades que define a dura√ß√£o do projeto","Atividades com maior custo","Tarefas com maior HH"],ok:0,exp:"Atraso no caminho cr√≠tico atrasa o fim."},{q:"Relacionamento mais usado em obra:",opts:["Finish-to-Start (FS)","Start-to-Start (SS)","Finish-to-Finish (FF)"],ok:0,exp:"FS garante ordem l√≥gica b√°sica entre tarefas."},{q:"Calend√°rios no cronograma servem para:",opts:["Regras de trabalho (turnos/feriados)","C√°lculo de custo","Medi√ß√£o de qualidade"],ok:0,exp:"Fundamentais para dura√ß√£o realista."},{q:"Baseline √©:",opts:["Linha de refer√™ncia de prazo/custo","Relat√≥rio di√°rio","Matriz de riscos"],ok:0,exp:"Permite medir desvios do plano aprovado."},{q:"Nivelamento de recursos visa:",opts:["Suavizar picos de aloca√ß√£o","Reduzir custo por si s√≥","Eliminar caminho cr√≠tico"],ok:0,exp:"Evita sobrecarga e ociosidade."},{q:"Lead e Lag significam:",opts:["Adiantamento e atraso entre tarefas","Tipos de marcos","Modos de calend√°rio"],ok:0,exp:"Ajustam a sobreposi√ß√£o/espera entre atividades."},{q:"WBS (EAP) no cronograma:",opts:["Estrutura hier√°rquica do escopo","Lista de materiais","Fluxo de caixa"],ok:0,exp:"A base do sequenciamento e medi√ß√£o."},{q:"Marco (milestone) possui:",opts:["Dura√ß√£o zero","Dura√ß√£o fixa de 1 dia","HH m√°ximo"],ok:0,exp:"Marcos n√£o consomem dura√ß√£o."},{q:"No controle semanal, o cronograma deve:",opts:["Refletir a realidade rapidamente","Ser alterado mensalmente","Permanecer est√°tico"],ok:0,exp:"Atualiza√ß√£o √°gil aumenta precis√£o da gest√£o."}];
QUIZZES[3]=[{q:"WWP define:",opts:["Plano execut√°vel da semana","Plano financeiro do m√™s","Plano de compras do trimestre"],ok:0,exp:"WWP detalha tarefas que atenderam crit√©rios de prontid√£o."},{q:"Para montar WWP, √© essencial:",opts:["Eng. liberada, materiais e frente de trabalho","Apenas equipe","Apenas guindaste"],ok:0,exp:"Sem restri√ß√µes pendentes."},{q:"Sequenciamento semanal deve considerar:",opts:["Interfer√™ncias e seguran√ßa","Somente dist√¢ncia f√≠sica","Somente custo"],ok:0,exp:"Evitar atividades sobrepostas inseguras."},{q:"PPC semanal serve para:",opts:["Avaliar ader√™ncia e causas de falha","Medir custo","Medir satisfa√ß√£o"],ok:0,exp:"Permite aprendizado e ajuste."},{q:"Lookahead t√≠pico:",opts:["2‚Äì6 semanas √† frente","1 dia","1 ano"],ok:0,exp:"Janela para remover restri√ß√µes."},{q:"Ao mudar prioridade no meio da semana:",opts:["Replanejar com equipe envolvida","Deixar como est√°","Apagar tarefas"],ok:0,exp:"Replanejamento colaborativo mant√©m compromisso."},{q:"Entrega de materiais no WWP:",opts:["JIT (no tempo certo) quando poss√≠vel","Sempre antecipada demais","Sem coordena√ß√£o"],ok:0,exp:"Evita estoque e espera."},{q:"Crit√©rio de pronto:",opts:["Check de seguran√ßa, projeto, material, acesso","Apenas seguran√ßa","Apenas projeto"],ok:0,exp:"Checklist reduz variabilidade."},{q:"Quadro visual semanal ajuda a:",opts:["Transpar√™ncia e foco","Aumentar burocracia","Diminuir comunica√ß√£o"],ok:0,exp:"Suporte √† gest√£o √† vista."},{q:"Reuni√£o di√°ria de 15 min na semana:",opts:["Alinhar desvios e riscos","Aprovar folhas de pagamento","Debater or√ßamento anual"],ok:0,exp:"Ritmo curto fecha o ciclo PDCA."}];
QUIZZES[4]=[{q:"Qual √© o principal objetivo da EAP?",opts:["Estruturar o escopo em partes control√°veis","Listar materiais","Criar √≠ndices de produtividade"],ok:0,exp:"A EAP quebra o escopo em pacotes gerenci√°veis."},{q:"No AWP, o que representa o CWP?",opts:["Construction Work Package","Contract Work Package","Cost Work Package"],ok:0,exp:"CWP = pacote de trabalho de constru√ß√£o."},{type:"order",q:"Qual √© a sequ√™ncia correta entre os pacotes AWP?",items:["EWP","CWP","IWP"],correctOrder:["EWP","CWP","IWP"],exp:"Engenharia ‚Üí Constru√ß√£o ‚Üí Instala√ß√£o."},{q:"Quem normalmente detalha o IWP?",opts:["Planejamento + Supervis√£o de Campo","Financeiro","Seguran√ßa"],ok:0,exp:"Planejamento com a supervis√£o definem escopo execut√°vel."},{q:"A EAP contribui para:",opts:["Rastreabilidade e controle","Aumentar burocracia","Dificultar medi√ß√µes"],ok:0,exp:"Padroniza controle e integra com √≠ndices/custos."},{q:"At√© que n√≠vel a EAP deve ir?",opts:["At√© suportar controle de prazo e custo","Sempre at√© 7 n√≠veis","Apenas 2 n√≠veis"],ok:0,exp:"Profundidade suficiente para gest√£o eficaz."},{q:"Benef√≠cio de libera√ß√£o progressiva no AWP:",opts:["Fluxo cont√≠nuo de frentes","Mais retrabalho","Menos visibilidade"],ok:0,exp:"Libera √°reas/zonas por marcos de engenharia/suprimentos."},{q:"Quando o AWP deve come√ßar a ser aplicado?",opts:["No planejamento da engenharia","Somente na obra","Ap√≥s o comissionamento"],ok:0,exp:"Come√ßa na engenharia para orquestrar o fluxo fim-a-fim."},{q:"O IWP deve conter:",opts:["Instru√ß√µes, materiais, desenhos e requisitos de seguran√ßa","Apenas custo","Somente cronograma"],ok:0,exp:"Conte√∫do completo para execu√ß√£o segura e rastre√°vel."},{q:"Uma boa EAP facilita a integra√ß√£o com:",opts:["Cronograma, √≠ndices e medi√ß√µes","Somente planilhas financeiras","Apenas reuni√µes"],ok:0,exp:"Conecta planejamento, custos e f√≠sico."}];
QUIZZES[5]=[{q:"Folha-Tarefa serve para:",opts:["Registrar ader√™ncia di√°ria e bloqueios","Emitir pedido de compra","Apresentar or√ßamento ao cliente"],ok:0,exp:"Base para PPC, causas e produtividade."},{q:"Campo essencial na Folha-Tarefa:",opts:["Equipe, HH, atividade e status","N√∫mero de nota fiscal","C√≥digo do fornecedor"],ok:0,exp:"Garante rastreio e medi√ß√£o di√°ria."},{q:"Ader√™ncia di√°ria idealmente √©:",opts:[">= 85% com causas mapeadas","50%","100% sem explicar falhas"],ok:0,exp:"Mais que a meta, importa entender desvios."},{q:"A Folha-Tarefa conecta-se com:",opts:["WWP/PPC e Painel de Bordo","Somente RH","Somente compras"],ok:0,exp:"Integra execu√ß√£o com indicadores."},{q:"‚ÄòTarefa conclu√≠da‚Äô significa:",opts:["Atende crit√©rios de qualidade e seguran√ßa","Entrada no sistema","Guincho liberado"],ok:0,exp:"Fechamento requer crit√©rios objetivos."},{q:"Para robustez, a Folha-Tarefa deve:",opts:["Ter campos padronizados e explicativos","Ser livre e sem padr√£o","Ser textual somente"],ok:0,exp:"Padroniza√ß√£o evita ambiguidade."},{q:"Bloqueios recorrentes devem gerar:",opts:["Plano de a√ß√£o e dono","Arquivo morto","Apenas coment√°rio"],ok:0,exp:"Fechar o loop com respons√°veis e prazo."},{q:"Quando registrar a tarefa:",opts:["No dia, durante ou ao final do turno","Somente no fim da semana","Somente no in√≠cio do projeto"],ok:0,exp:"Timeliness aumenta qualidade do dado."},{q:"Medi√ß√£o HH Real vem de:",opts:["Apontamentos confi√°veis","Estimativas mensais","C√°lculo fixo"],ok:0,exp:"Apontamento de campo √© base de verdade."},{q:"Dados da Folha-Tarefa alimentam:",opts:["Curva S e produtividade","Apenas folha de pagamento","Apenas relat√≥rio fotogr√°fico"],ok:0,exp:"Transformam execu√ß√£o em indicador."}];
QUIZZES[6]=[{q:"Produtos Not√°veis √©:",opts:["Matriz de √≠ndices por disciplina/servi√ßo","Lista de compras","Di√°rio de obra"],ok:0,exp:"Define HH/ton, HH/m, etc., por item."},{q:"Exemplo de √≠ndice real:",opts:["200 hh/ton para tubula√ß√£o","20 kg/h para cimento","10 m¬≥/h para concreto estrutural"],ok:0,exp:"√çndices reais alimentam planejamento."},{q:"Para cabos, um √≠ndice comum √©:",opts:["‚âà0,25 hh/m","5 hh/m","2 hh/m"],ok:0,exp:"Usado para planejar e medir produtividade."},{q:"Planilha deve conter:",opts:["Previsto vs Real e varia√ß√£o","Somente previsto","Somente real"],ok:0,exp:"Permite an√°lise de desempenho."},{q:"√çndices calibram:",opts:["Planejamento, aloca√ß√£o e metas","Somente compras","Somente RH"],ok:0,exp:"Transformam engenharia em horas e custo."},{q:"Desvio negativo indica:",opts:["Produtividade abaixo do esperado","Adiantamento","Erro de medi√ß√£o do cliente"],ok:0,exp:"A√ß√£o corretiva e causa-raiz."},{q:"Para simular cen√°rios:",opts:["Use filtros por tag/√°rea/servi√ßo","Apenas total do projeto","Apenas HH m√©dio"],ok:0,exp:"Granularidade d√° precis√£o."},{q:"√çndices devem ser:",opts:["Atualizados e validados em campo","Fixos para sempre","Secretos"],ok:0,exp:"Melhoram com aprendizado."},{q:"Integra√ß√£o com Painel:",opts:["KPIs de varia√ß√£o e hit-rate","Apenas fotos","Apenas custos"],ok:0,exp:"Torna a gest√£o visual acion√°vel."},{q:"Ao revisar √≠ndices:",opts:["Considere mix de equipes e frentes","Ignore clima","Ignore log√≠stica"],ok:0,exp:"Contexto muda produtividade."}];
QUIZZES[7]=[{q:"Painel de Bordo bom mostra:",opts:["KPIs claros e atualizados","Somente planilhas","Textos longos"],ok:0,exp:"Foco em decis√µes r√°pidas."},{q:"KPI de produ√ß√£o t√≠pico:",opts:["% avan√ßo, varia√ß√£o p.p., PPC","Taxa de c√¢mbio","Rotatividade anual"],ok:0,exp:"Reflete ritmo e ader√™ncia."},{q:"Atualiza√ß√£o do painel:",opts:["Semanal como padr√£o","Anual","A cada 6 meses"],ok:0,exp:"Alimenta rea√ß√£o r√°pida."},{q:"Alertas visuais servem para:",opts:["Chamar aten√ß√£o a desvios","Enfeitar","Substituir dados"],ok:0,exp:"Prioriza a a√ß√£o."},{q:"Boa pr√°tica de dashboard:",opts:["Fonte √∫nica de verdade (SSOT)","V√°rias vers√µes paralelas","Planilhas isoladas"],ok:0,exp:"Evitar diverg√™ncias."},{q:"Para decis√µes de curto prazo:",opts:["KPIs de fluxo e gargalos","Somente custo acumulado","Somente satisfa√ß√£o anual"],ok:0,exp:"Mostra onde atacar."},{q:"Drill-down √©:",opts:["Explorar detalhe por disciplina/√°rea","Exportar para PDF","Apagar hist√≥rico"],ok:0,exp:"Permite investiga√ß√£o r√°pida."},{q:"Painel conecta-se a:",opts:["Folha-Tarefa, WWP, Curva S","Somente RH","Somente compras"],ok:0,exp:"Integra execu√ß√£o e controle."},{q:"Defini√ß√£o de meta de PPC:",opts:["Clara, com respons√°vel e prazo","'Melhorar PPC um dia'","Sem dono"],ok:0,exp:"Meta sem dono n√£o anda."},{q:"Layout eficaz usa:",opts:["Poucas cores e hierarquia visual","Muitas cores fortes","Sombras exageradas"],ok:0,exp:"Design ajuda a leitura."}];
QUIZZES[8]=[{q:"O objetivo do Rundown √©:",opts:["Comparar avan√ßo semanal planejado x realizado","Registrar custos","Organizar equipes"],ok:0,exp:"Mostra ritmo semanal e alimenta a Curva S."},{q:"Base de c√°lculo da Curva S:",opts:["Pesos f√≠sicos (HH, ton, m)","Somente custo","Horas extras"],ok:0,exp:"Pesos f√≠sicos por atividade."},{type:"calc",q:"PR√ÅTICA ‚Äî Real 35% e Plano 40%: desvio =",answer:-5,tolerance:0.5,unit:"%",exp:"Desvio = Real ‚àí Plano = ‚àí5 p.p. (atraso)."},{q:"Frequ√™ncia t√≠pica do Rundown:",opts:["Semanal","Mensal","Anual"],ok:0,exp:"Semanal para rea√ß√£o r√°pida."},{q:"Vantagem da Curva S:",opts:["Visualizar tend√™ncias e desvios","Calcular HH/dia","Organizar contratos"],ok:0,exp:"Evidencia ader√™ncia ao plano."},{type:"calc",q:"Se na semana o Plano=8% e o Real=10%, varia√ß√£o semanal =",answer:2,tolerance:0.2,unit:"p.p.",exp:"10 ‚àí 8 = +2 p.p. (adiantado)."},{q:"Para Curva S confi√°vel, √© essencial:",opts:["Crit√©rios de medi√ß√£o claros","Somente horas apontadas","Apenas quantidade de equipes"],ok:0,exp:"Defina pesos, marcos e periodicidade."},{type:"text",q:"PR√ÅTICA ‚Äî Diga um motivo t√≠pico para desvio negativo:",answerText:["falta de material","restri√ß√£o","atraso de projeto","acesso","gargalo"],exp:"Restri√ß√£o n√£o tratada √© causa comum."},{type:"order",q:"Ordem l√≥gica de leitura:",items:["Rundown semanal","Curva S acumulada","Plano de a√ß√£o"],correctOrder:["Rundown semanal","Curva S acumulada","Plano de a√ß√£o"],exp:"Ritmo ‚Üí tend√™ncia ‚Üí a√ß√£o."},{q:"Indicador derivado √∫til:",opts:["Desvio acumulado p.p.","N¬∫ de e-mails","Horas de reuni√£o"],ok:0,exp:"Mostra magnitude do atraso/adianto."}];
QUIZZES[9]=[{q:"Produtividade √©:",opts:["Quantidade produzida por HH","HH por custo","Custo por item"],ok:0,exp:"Base para metas e compara√ß√µes."},{q:"Para comparar equipes, padronize:",opts:["Unidades e crit√©rios de medi√ß√£o","Somente nomes das equipes","Foto do servi√ßo"],ok:0,exp:"Sem padroniza√ß√£o n√£o h√° an√°lise."},{q:"√çndice 200 hh/ton significa:",opts:["Horas para montar 1 tonelada","Toneladas por hora","Custo por tonelada"],ok:0,exp:"Converte escopo em HH planejado."},{q:"Ao cair produtividade:",opts:["Investigue causas-raiz (gargalo, log√≠stica, clima...)","Ignore porque recupera depois","Cobre metas sem dados"],ok:0,exp:"An√°lise t√©cnica orienta a√ß√£o."},{q:"Medida rolling semanal ajuda a:",opts:["Suavizar ru√≠do e ver tend√™ncia","Aumentar ru√≠do","Esconder desvios"],ok:0,exp:"M√©dia m√≥vel estabiliza leitura."},{q:"Benchmark interno deve:",opts:["Comparar √°reas e frentes similares","Misturar tudo","Ser anual apenas"],ok:0,exp:"Compar√°vel √© o que importa."},{q:"√çndices devem ser usados para:",opts:["Planejar e medir, n√£o punir","Punir","Arquivar"],ok:0,exp:"Evita jogo de n√∫meros."},{q:"Para cabos, rendimento t√≠pico:",opts:["0,25 hh/m (exemplo)","2 hh/m","5 hh/m"],ok:0,exp:"Exemplo usual em el√©trica."},{q:"Visualiza√ß√£o ideal:",opts:["Run charts e dispers√£o","Texto corrido","Pizza sempre"],ok:0,exp:"Mostram rela√ß√£o e tend√™ncia."},{q:"Meta deve ser:",opts:["Alcan√ß√°vel e negociada com execu√ß√£o","Definida isoladamente","Secreta"],ok:0,exp:"Acordo aumenta ades√£o."}];
QUIZZES[10]=[{q:"Reuni√£o di√°ria (daily) ideal dura:",opts:["10‚Äì15 minutos","60 minutos","90 minutos"],ok:0,exp:"R√°pida, foco no desvio e a√ß√£o."},{q:"Obeya √©:",opts:["Sala/ritual de gest√£o com dados visuais","Software de cronograma","Ferramenta de compras"],ok:0,exp:"Transpar√™ncia e ritmo de decis√£o."},{q:"Em reuni√µes Lean, cada a√ß√£o deve ter:",opts:["Dono e prazo","Somente descri√ß√£o","S√≥ prioridade"],ok:0,exp:"Sem dono n√£o sai do papel."},{q:"Ritmo de reuni√µes recomendado:",opts:["Di√°rias, semanais e mensais com pauta definida","Somente mensais","Quando der"],ok:0,exp:"Cad√™ncia gera previsibilidade."},{q:"Pauta de WWP inclui:",opts:["Remo√ß√£o de restri√ß√µes e compromisso","Aprova√ß√£o de faturas","Planejamento anual"],ok:0,exp:"Foco na prontid√£o e compromisso."},{q:"Quadro de a√ß√µes deve mostrar:",opts:["Status, dono, prazo e impacto","Somente t√≠tulo","Somente data"],ok:0,exp:"Gest√£o √† vista acelera execu√ß√£o."},{q:"Reuni√£o eficaz come√ßa com:",opts:["Objetivo claro e dados atualizados","Check-in social longo","Slides extensos"],ok:0,exp:"Clareza e dados sustentam decis√µes."},{q:"Ao surgir conflito de prioridade:",opts:["Negociar com base em marcos e restri√ß√µes","Impor pela hierarquia","Ignorar"],ok:0,exp:"Fluxo global > otimiza√ß√£o local."},{q:"Tempo de reuni√£o deve ser usado para:",opts:["Decidir e remover impedimentos","Atualizar status manual","Contar hist√≥rias"],ok:0,exp:"Decis√£o e desbloqueio criam valor."},{q:"Follow-up p√≥s reuni√£o:",opts:["Resumo + checklist de a√ß√µes","Somente ata t√©cnica","Nada √© necess√°rio"],ok:0,exp:"Garante accountability."}];
QUIZZES[11]=[{q:"Restri√ß√£o √©:",opts:["Qualquer fator que impede execu√ß√£o","Somente falta de material","Somente chuva"],ok:0,exp:"Pode ser projeto, acesso, seguran√ßa, libera√ß√£o etc."},{q:"Planilha de restri√ß√µes deve ter:",opts:["Descri√ß√£o, respons√°vel e prazo","Somente descri√ß√£o","Somente data"],ok:0,exp:"Garante ciclo de remo√ß√£o."},{q:"Fonte t√≠pica de restri√ß√µes:",opts:["Engenharia, suprimentos e acesso","Sorriso da equipe","Escrit√≥rio central"],ok:0,exp:"Principais gargalos do campo."},{q:"Lookahead serve para:",opts:["Antecipar e tratar restri√ß√µes futuras","Gerar notas fiscais","Planejar f√©rias"],ok:0,exp:"Prepara a execu√ß√£o."},{q:"Sem dono definido:",opts:["Restri√ß√£o tende a permanecer","Resolve mais r√°pido","Fica mais barata"],ok:0,exp:"Responsabiliza√ß√£o acelera."},{q:"Sinal verde no quadro significa:",opts:["Restri√ß√£o removida","Nova restri√ß√£o","A√ß√£o atrasada"],ok:0,exp:"Sem√°foro visual simples."},{q:"Causa raiz ajuda a:",opts:["Evitar recorr√™ncia","Culpar pessoas","Eliminar relat√≥rios"],ok:0,exp:"Aprendizado organizacional."},{q:"Integra√ß√£o com WWP:",opts:["Tarefas s√≥ entram 'prontas' (sem restri√ß√µes)","Entram mesmo com bloqueio","N√£o se relacionam"],ok:0,exp:"Prontid√£o √© pr√©-requisito."},{q:"Priorizar restri√ß√µes por:",opts:["Impacto no caminho cr√≠tico/ritmo","Ordem alfab√©tica","Quem grita mais"],ok:0,exp:"Ataca o que mais afeta o fluxo."},{q:"Ferramenta √∫til para restri√ß√µes:",opts:["Quadro Kanban/sem√°foro","Bate-papo informal","E-mail solto"],ok:0,exp:"Gest√£o visual acelera."}];
QUIZZES[12]=[{q:"‚ÄòWaste Time‚Äô no canteiro √©:",opts:["Tempo perdido por falta de planejamento/log√≠stica","Tempo de descanso legal","Tempo de almo√ßo"],ok:0,exp:"Reduzir WT aumenta produtividade."},{q:"Exemplo de WT:",opts:["Equipe aguardando material/libera√ß√£o","Execu√ß√£o com todas frentes prontas","Tarefa finalizada no prazo"],ok:0,exp:"Aguardo √© perda de fluxo."},{q:"Ferramenta para reduzir WT:",opts:["Tele Materiais / gest√£o de entregas","Apenas cobran√ßa","E-mail em massa"],ok:0,exp:"Sistema puxa materiais no tempo certo."},{q:"Mapa de fluxo ajuda a:",opts:["Identificar gargalos e esperas","Criar mais passos","Otimizar localmente"],ok:0,exp:"Vis√£o ponta a ponta."},{q:"Medi√ß√£o de WT pode usar:",opts:["% do tempo √∫til vs parado","Somente HH total","Somente custo"],ok:0,exp:"Quantificar para reduzir."},{q:"Layout de canteiro impacta:",opts:["Log√≠stica e WT","Somente seguran√ßa","Nada"],ok:0,exp:"Fluxos menores = menos espera."},{q:"Padroniza√ß√£o (5S) reduz:",opts:["Procuras e retrabalhos","Custo fixo","Tempo de reuni√£o"],ok:0,exp:"Organiza√ß√£o elimina perda."},{q:"Planejamento de i√ßamento evita:",opts:["Interfer√™ncia e espera de √°reas vizinhas","Qualidade","Contrato"],ok:0,exp:"Evitar bloqueios por sobreposi√ß√£o."},{q:"Para sustentar ganhos:",opts:["Rotina de revis√£o de WT e a√ß√µes","Somente campanha √∫nica","Ignorar dados"],ok:0,exp:"Ciclo cont√≠nuo de melhoria."},{q:"Indicador √∫til de WT:",opts:["Tempo perdido por causa e √°rea","Quantidade de e-mails","N¬∫ de reuni√µes"],ok:0,exp:"Direciona ataque aos maiores vil√µes."}];
const QUIZ_FALLBACK=[
  {q:"Pergunta gen√©rica 1",opts:["A","B","C"],ok:0,exp:"Explica√ß√£o."},
  {q:"Pergunta gen√©rica 2",opts:["A","B","C"],ok:1,exp:"Explica√ß√£o."},
  {q:"Pergunta gen√©rica 3",opts:["A","B","C"],ok:2,exp:"Explica√ß√£o."},
  {q:"Pergunta gen√©rica 4",opts:["A","B","C"],ok:0,exp:"Explica√ß√£o."},
  {q:"Pergunta gen√©rica 5",opts:["A","B","C"],ok:1,exp:"Explica√ß√£o."},
  {q:"Pergunta gen√©rica 6",opts:["A","B","C"],ok:0,exp:"Explica√ß√£o."},
  {q:"Pergunta gen√©rica 7",opts:["A","B","C"],ok:2,exp:"Explica√ß√£o."},
  {q:"Pergunta gen√©rica 8",opts:["A","B","C"],ok:1,exp:"Explica√ß√£o."},
  {q:"Pergunta gen√©rica 9",opts:["A","B","C"],ok:2,exp:"Explica√ß√£o."},
  {q:"Pergunta gen√©rica 10",opts:["A","B","C"],ok:0,exp:"Explica√ß√£o."},
];

// ====== State ======
const STATE_KEY="duoplanning.v42.state";
let S=JSON.parse(localStorage.getItem(STATE_KEY) || "null")||{name:"",xp:0,energy:3,levelId:"Tecnico",streak:0,lastLoginDay:"",cleared:{},week:{startIso:"",modulesDone:0},dailyDoneOn:"",rank:[{name:"Voc√™",xp:0},{name:"Alice",xp:560},{name:"Bruno",xp:320}]};
function save(){ localStorage.setItem(STATE_KEY, JSON.stringify(S)); }


// ====== Online Leaderboard (Firebase Firestore) ======
// 1) Preencha sua configura√ß√£o abaixo (Projeto Firebase ‚Üí Config Web App)
const FB_CONFIG = {
  apiKey: "PASTE_YOUR_API_KEY",
  authDomain: "PASTE_YOUR_AUTH_DOMAIN",
  projectId: "PASTE_YOUR_PROJECT_ID",
  // opcional: storageBucket, messagingSenderId, appId
};
let Online = {enabled:false, ready:false, last:[], unsub:null};
// ====== Online init with Anonymous Auth ======
Online.status = "offline"; // 'online' | 'offline' | 'loading'
function updateRankHeader(){
  const hdr = document.querySelector('[data-i18n="rank_hdr"]');
  if (!hdr) return;
  if (Online.enabled && Online.ready) hdr.textContent = (lang==='en'?'Ranking (online)':'Ranking (online)');
  else if (Online.enabled && !Online.ready) hdr.textContent = (lang==='en'?'Ranking (loading...)':'Ranking (carregando...)');
  else hdr.textContent = (lang==='en'?'Ranking (local)':'Ranking (local)');
}
function OnlineInit(){
  if (!Online.enabled || Online.ready) { updateRankHeader(); return; }
  try{
    Online.status = "loading";
    updateRankHeader();
    firebase.auth().onAuthStateChanged((user)=>{
      if (user) {
        Online.user = user;
        onlineUpsertScore();
        onlineSubscribeLeaderboard(20);
      } else {
        firebase.auth().signInAnonymously().catch(e=>console.warn('Anon auth error', e));
      }
    });
    // kickoff auth if not already
    if (!firebase.auth().currentUser) firebase.auth().signInAnonymously().catch(()=>{});
  }catch(e){ console.warn("OnlineInit error:", e); }
}

try{
  if (FB_CONFIG.apiKey && FB_CONFIG.projectId) {
    firebase.initializeApp(FB_CONFIG);
    Online.db = firebase.firestore();
    Online.enabled = true;
  }
}catch(e){ console.warn("Firebase init error:", e); Online.enabled=false; }

function uid(){
  const KEY="duoplanning.uid";
  let id=localStorage.getItem(KEY);
  if(!id){ id = Math.random().toString(36).slice(2) + Date.now().toString(36); localStorage.setItem(KEY,id); }
  return id;
}

function onlineUpsertScore(){
  if(!Online.enabled || !Online.db) return;
  const L=currentLevel();
  const docId = uid();
  Online.db.collection("leaderboard").doc(docId).set({
    name: S.name || "Jogador",
    xp: S.xp || 0,
    levelId: S.levelId || "Tecnico",
    levelName: L.name,
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  }, {merge:true}).catch(err=>console.warn("Upsert score error:", err));
}

function onlineSubscribeLeaderboard(limit=20){
  if(!Online.enabled || !Online.db) return;
  if(Online.unsub) try{ Online.unsub(); }catch(e){}
  Online.unsub = Online.db.collection("leaderboard")
    .orderBy("xp","desc")
    .limit(limit)
    .onSnapshot(snap=>{
      Online.last = [];
      snap.forEach(doc=> Online.last.push(doc.data()));
      Online.ready = true; Online.status = "online";
      renderDash();  // re-render ranking ao chegar dados
    }, err=>{
      console.warn("Leaderboard subscribe error:", err);
      Online.ready = false; Online.status = "offline";
      renderDash();
    });
}
// ====== Helpers ======
function todayKey(){const d=new Date();return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0")}
function mondayOfThisWeekISO(){const d=new Date();const day=d.getDay();const diff=(day===0?-6:1-day);const m=new Date(d);m.setDate(d.getDate()+diff);return m.toISOString().slice(0,10)}
function currentLevel(){let L=LEVELS[0];for(const lv of LEVELS){if(S.xp>=lv.minXP)L=lv}S.levelId=L.id;return L}
function addXP(v){S.xp+=v;toast("+"+v+" "+t("xp"));try{ if(Settings.sound) document.getElementById("audioWin").play().catch(()=>{}) }catch(e){}; if(Settings.confetti){confetti({particleCount:120,spread:65,origin:{y:.6}})} save(); onlineUpsertScore(); renderDash();}
function toast(msg){const tEl=document.getElementById("toast");tEl.textContent=msg;tEl.style.display="block";setTimeout(()=>tEl.style.display="none",1800)}

// ====== Render ======
function renderDash(){
  const L=currentLevel();
  document.getElementById("hello").textContent = (lang==="en"?"Hello, ":"Hola, ") && (lang==="pt" ? `Ol√°, ${S.name||"Jogador"}` : (lang==="en"?`Hello, ${S.name||"Player"}`:`Hola, ${S.name||"Jugador"}`));
  document.getElementById("roleMini").textContent=`${L.name} ‚Äî ${L.desc}`;
  document.getElementById("levelNowPill").textContent=`${L.icon} ${L.name}`;
  document.getElementById("xpNow").textContent=S.xp;
  document.getElementById("xpGoal").textContent=isFinite(L.nextXP)?L.nextXP:"‚àû";
  const pct=isFinite(L.nextXP)?Math.max(0,Math.min(100,100*(S.xp-L.minXP)/(L.nextXP-L.minXP))):100;
  document.getElementById("xpBar").style.width=pct+"%";
  document.getElementById("streak").textContent="üî• "+S.streak;
  document.getElementById("energy").textContent=S.energy;

  const mondayIso=mondayOfThisWeekISO();
  if(S.week.startIso!==mondayIso){S.week.startIso=mondayIso;S.week.modulesDone=0;save()}
  document.getElementById("weekProg").textContent=`(${S.week.modulesDone}/3)`;
  document.getElementById("weekBar").style.width=Math.min(100,(S.week.modulesDone/3)*100)+"%";

  const mods=document.getElementById("mods");mods.innerHTML="";
  MODULES.forEach(m=>{
    const locked=(m.nivel!==L.name);const score=S.cleared[m.id]||0;
    const icon=(m.nivel==='T√©cnico'?'üë∑':m.nivel==='Analista'?'üë®‚Äçüíª':m.nivel==='Especialista'?'üë®‚Äçüîß':m.nivel==='Gerente/Diretor'?'üëî':'üîÆ');
    const el=document.createElement("div");el.className="mod";
    const lockedText = lang==='en'?'Locked':(lang==='es'?'Bloqueado':'bloqueado');
    const notStarted = lang==='en'?'Not started':(lang==='es'?'No iniciado':'Ainda n√£o iniciado');
    const bestLabel = lang==='en'?'best:':(lang==='es'?'mejor:':'melhor:');
    el.innerHTML=`<div class="left"><div class="lvl">${icon}</div><div><div><b>${m.titulo}</b> <span class="meta">#${m.id} ¬∑ ${m.nivel}</span></div><div class="meta">${locked?'<span class="lock">üîí '+lockedText+'</span>':(score?bestLabel+` ${score}/10`:notStarted)}</div></div></div><div>${score?`<span class="meta">${bestLabel} ${score}/10</span>`:""}<button class="btn" ${locked?'disabled':''} data-mod="${m.id}">${locked?'üîí':'‚ñ∂Ô∏è '+(lang==='en'?'Start':(lang==='es'?'Iniciar':'Iniciar'))}</button></div>`;
    mods.appendChild(el);
  });
  document.querySelectorAll('[data-mod]').forEach(b=>b.onclick=(e)=>{startQuiz(+e.currentTarget.getAttribute('data-mod'))});

  
  // Render ranking (online se dispon√≠vel, sen√£o local) + medalhas + barra
  const rankDiv = document.getElementById("rankList");
  if (rankDiv) {
    // Header status
    updateRankHeader();
    // Refresh button
    rankDiv.innerHTML = "";
    const btn = document.createElement("button");
    btn.className = "btn ghost";
    btn.style.marginBottom = "8px";
    btn.textContent = (lang==='en'?'Refresh ranking':'Atualizar ranking');
    btn.onclick = ()=>{ if (Online.enabled){ onlineSubscribeLeaderboard(20);} renderDash(); };
    rankDiv.appendChild(btn);

    const data = (Online.enabled && Online.ready && Online.last.length) ? Online.last : (S.rank || []);
    if (!data.length) {
      const item = document.createElement("div");
      item.className = "meta";
      item.textContent = (Online.enabled? (lang==='en'?'Loading ranking...':'Carregando ranking...') : (lang==='en'?'No ranking data':'Sem dados de ranking.'));
      rankDiv.appendChild(item);
    } else {
      data.slice(0,20).forEach((r,i)=>{
        const item = document.createElement("div");
        item.className = "mod";
        item.style.display = "flex";
        item.style.flexDirection = "column";
        const name = r.name || "Jogador";
        const xp = r.xp || 0;

        // Medalha para top 3
        const medal = i===0?'ü•á':(i===1?'ü•à':(i===2?'ü•â':'#'+(i+1)));
        // Estimar n√≠vel por XP
        let Lname='T√©cnico', Lmin=0, Lnext=1000, Licon='üë∑';
        try{
          let Ltmp = LEVELS[0];
          for (const lv of LEVELS){ if (xp>=lv.minXP) Ltmp = lv; }
          Lname = Ltmp.name; Lmin = Ltmp.minXP; Lnext = isFinite(Ltmp.nextXP)?Ltmp.nextXP:(xp||1);
          Licon = (Lname==='T√©cnico'?'üë∑':Lname==='Analista'?'üë®‚Äçüíª':Lname==='Especialista'?'üë®‚Äçüîß':Lname==='Gerente/Diretor'?'üëî':'üîÆ');
        }catch(e){/* noop */}
        const pct = Math.max(0, Math.min(100, (100*(xp - Lmin)/((Lnext - Lmin)||1))));

        item.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;width:100%">
            <div><b>${medal}</b> ${Licon} ${name} <span class="meta">(${Lname})</span></div>
            <div class="meta">${xp} XP</div>
          </div>
          <div class="xpbar" style="margin-top:6px"><i style="width:${pct}%"></i></div>
        `;
        rankDiv.appendChild(item);
      });
    }
  }
applyI18n();
}

// ====== Login ======
function doLogin(){
  const name=(document.getElementById("inpName").value||"").trim()||(lang==="en"?"Player":(lang==="es"?"Jugador":"Jogador"));
  S.name=name;S.levelId="Tecnico";
  const tk=todayKey();
  if(S.lastLoginDay!==tk){S.streak=(S.lastLoginDay && ((new Date(tk)-new Date(S.lastLoginDay))===86400000))?(S.streak+1):1;S.lastLoginDay=tk}
  save(); OnlineInit(); onlineUpsertScore();
  // hide brand + login, show top bar + dash
  document.getElementById("brandLogin").classList.add("hidden");
  document.getElementById("viewLogin").classList.add("hidden");
  document.getElementById("topBar").classList.remove("hidden");
  const dash=document.getElementById("viewDash");
  dash.classList.remove("hidden"); setTimeout(()=>dash.classList.add("show"),0);
  document.getElementById("btnLogout").classList.remove("hidden");
  renderDash();
  toast(t("welcome"));
}
document.getElementById("btnLogin").onclick=doLogin;
document.getElementById("btnLogout").onclick=()=>{localStorage.removeItem(STATE_KEY);location.reload()};

// ====== Quiz ======
let curQuiz=null,curIdx=0,curScore=0,curModId=0;
function pickTen(qs){if(qs.length<=10)return qs.slice();const arr=qs.slice();const out=[];while(out.length<10&&arr.length){const i=Math.floor(Math.random()*arr.length);out.push(arr.splice(i,1)[0])}return out}
function startQuiz(modId){curModId=modId;const raw=QUIZZES[modId]||QUIZZES[13]||QUIZ_FALLBACK;curQuiz=pickTen(raw);curIdx=0;curScore=0;document.getElementById("quizTitle").textContent=`${t("modules_hdr")} #${modId}`;document.getElementById("quizOverlay").style.display="flex";document.getElementById("qExplain").classList.add("hidden");renderQuestion()}
function closeQuiz(){document.getElementById("quizOverlay").style.display="none"}
document.getElementById("btnCloseQuiz").onclick=closeQuiz;
function renderQuestion(){
  const q=curQuiz[curIdx];document.getElementById("qNum").textContent=(curIdx+1);document.getElementById("qText").textContent=q.q;
  const box=document.getElementById("qOpts");const exp=document.getElementById("qExplain");exp.classList.add("hidden");exp.textContent="";box.innerHTML="";
  const L=currentLevel();const XP_HIT=XP_PER_LEVEL[L.id]||30;
  function addOpt(label,isCorrect){const div=document.createElement("div");div.className="opt";div.textContent=label;div.onclick=()=>{if(isCorrect){div.classList.add("correct");curScore++;addXP(XP_HIT)}else{div.classList.add("wrong")}exp.textContent=q.exp||"";exp.classList.remove("hidden");box.querySelectorAll(".opt").forEach(o=>o.style.pointerEvents="none")};box.appendChild(div)}
  if(!q.type||q.type==="multi-choice"){q.opts.forEach((o,i)=>addOpt(o,i===q.ok))}
  else if(q.type==="text"){const inp=document.createElement("input");inp.type="text";inp.placeholder=lang==="en"?"Type your answer...":(lang==="es"?"Escribe tu respuesta...":"Digite sua resposta...");box.appendChild(inp);const btn=document.createElement("button");btn.className="btn";btn.textContent="Validar";btn.onclick=()=>{const val=(inp.value||"").toLowerCase().trim();const arr=(q.answerText||[]).map(x=>x.toLowerCase());const ok=arr.some(x=>val.includes(x));if(ok){addXP(XP_HIT);exp.textContent=q.exp||"Correto."}else{exp.textContent=q.exp||"Revise o conceito."}exp.classList.remove("hidden");btn.disabled=true};box.appendChild(btn)}
  else if(q.type==="calc"){const inp=document.createElement("input");inp.type="number";inp.step="any";inp.placeholder=lang==="en"?"Value":"Valor";box.appendChild(inp);const btn=document.createElement("button");btn.className="btn";btn.textContent="Calcular";btn.onclick=()=>{const v=parseFloat(inp.value);const tol=q.tolerance??0;const ok=Math.abs(v-q.answer)<=tol;if(ok){addXP(XP_HIT);exp.textContent=q.exp||"Certo!"}else{exp.textContent=`Esperado ‚âà ${q.answer}${q.unit?(" "+q.unit):""}. ${q.exp||""}`}exp.classList.remove("hidden");btn.disabled=true};box.appendChild(btn)}
  else if(q.type==="order"){const src=q.items.slice();const ul=document.createElement("div");ul.className="row";src.forEach((it)=>{const p=document.createElement("div");p.className="pill";p.draggable=true;p.textContent=it;p.ondragstart=(e)=>{e.dataTransfer.setData("text/plain",it)};ul.appendChild(p)});const target=document.createElement("div");target.className="row";target.style.minHeight="42px";target.ondragover=(e)=>e.preventDefault();target.ondrop=(e)=>{e.preventDefault();const t=e.dataTransfer.getData("text/plain");const el=Array.from(ul.children).find(x=>x.textContent===t);if(el){target.appendChild(el)}};box.appendChild(ul);box.appendChild(target);const btn=document.createElement("button");btn.className="btn";btn.textContent="Validar";btn.onclick=()=>{const arr=Array.from(target.children).map(x=>x.textContent);const ok=JSON.stringify(arr)===JSON.stringify(q.correctOrder);if(ok){addXP(XP_HIT);exp.textContent=q.exp||"Certo!"}else{exp.textContent=`Ordem esperada: ${q.correctOrder.join(" ‚Üí ")}. ${q.exp||""}`}exp.classList.remove("hidden");btn.disabled=true};box.appendChild(btn)}
}
document.getElementById("btnNext").onclick=()=>{if(!curQuiz)return;if(curIdx<curQuiz.length-1){curIdx++;renderQuestion()}else{const best=S.cleared[curModId]||0;if(curScore>best)S.cleared[curModId]=curScore;const tk=todayKey();if(curScore===10&&S.dailyDoneOn!==tk){S.dailyDoneOn=tk;addXP(20);toast(t("mission_daily_done"))}const mondayIso=mondayOfThisWeekISO();if(S.week.startIso!==mondayIso){S.week.startIso=mondayIso;S.week.modulesDone=0}S.week.modulesDone=Math.min(3,S.week.modulesDone+1);if(S.week.modulesDone===3){addXP(100);toast(t("mission_week_done"))}save();toast(t("module_done",{id:String(curModId),score:String(curScore)}));closeQuiz();renderDash()}};

// ====== Config handlers ======
document.getElementById("btnConfig").onclick=()=>{
  document.getElementById("cfgOverlay").style.display="flex";
  document.getElementById("selTheme").value=Settings.theme;
  document.getElementById("chkSound").checked=!!Settings.sound;
  document.getElementById("chkConfetti").checked=!!Settings.confetti;
  const ls=document.getElementById("langSel"); ls.value=lang;
  applyI18n();
};
document.getElementById("btnCloseCfg").onclick=()=>{document.getElementById("cfgOverlay").style.display="none"};
document.getElementById("selTheme").addEventListener("change",(e)=>{Settings.theme=e.target.value;saveSettings();applyTheme()});
document.getElementById("chkSound").addEventListener("change",(e)=>{Settings.sound=!!e.target.checked;saveSettings()});
document.getElementById("chkConfetti").addEventListener("change",(e)=>{Settings.confetti=!!e.target.checked;saveSettings()});
document.getElementById("langSel").addEventListener("change",(e)=>{
  lang = e.target.value;
  localStorage.setItem("duoplanning.lang", lang);
  applyI18n(); renderDash();
});
document.getElementById("btnReset").onclick=()=>{
  localStorage.removeItem(STATE_KEY);
  S={name:"",xp:0,energy:3,levelId:"Tecnico",streak:0,lastLoginDay:"",cleared:{},week:{startIso:"",modulesDone:0},dailyDoneOn:"",rank:[{name:"Voc√™",xp:0},{name:"Alice",xp:560},{name:"Bruno",xp:320}]};
  save(); toast(t("saved")); renderDash();
};

// ====== Init ======
applyTheme();
applyI18n();
if(S.name){ OnlineInit(); onlineUpsertScore();
  document.getElementById("brandLogin").classList.add("hidden");
  document.getElementById("viewLogin").classList.add("hidden");
  document.getElementById("topBar").classList.remove("hidden");
  const dash=document.getElementById("viewDash");
  dash.classList.remove("hidden"); setTimeout(()=>dash.classList.add("show"),0);
  document.getElementById("btnLogout").classList.remove("hidden");
  renderDash();
}
</script>
</body>
</html>
