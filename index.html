<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Duoplanning â€” v4.2 (Login com tÃ­tulo + Idiomas)</title>
  <meta name="color-scheme" content="dark light">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <audio id="audioWin" preload="auto">
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_0b6ce6218f.mp3?filename=success-fanfare-trumpets-6185.mp3" type="audio/mpeg">
  </audio>
  <style>
    :root{--bg:#0f1115;--text:#e9eef7;--muted:#a7b1c2;--primary:#3aa0ff;--accent:#ffb020;--success:#27c081;--danger:#ff5d5d;--panel:#161c24;--card:#141a22;--border:#273046;--locked:#6b7280}
    *{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--text);font:500 15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
    .wrap{max-width:1120px;margin:0 auto;padding:24px}
    h1,h2,h3{margin:0 0 12px}
    .brand{display:flex;justify-content:center;margin-bottom:16px}
    .brand h1{font-size:34px;letter-spacing:.3px}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.1)}
    .grid{display:grid;gap:12px}.grid.cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid.cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#111720;color:var(--text);cursor:pointer;transition:transform .15s ease}
    .btn.primary{background:var(--primary);color:#05131e;border:none}.btn.ghost{background:transparent}.btn:disabled{opacity:.6}
    .meta{color:var(--muted);font-size:13px}.badge{display:inline-flex;align-items:center;gap:6px;font-size:12px;color:#05131e;background:var(--accent);padding:4px 8px;border-radius:999px}
    .xpbar{height:10px;background:#0b111a;border:1px solid var(--border);border-radius:999px;overflow:hidden}.xpbar>i{display:block;height:100%;background:linear-gradient(90deg,var(--success),#6ee7b7)}
    .mod{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px;border:1px solid var(--border);border-radius:12px;background:#101723}
    .mod .left{display:flex;align-items:center;gap:10px}.mod .lvl{font-size:20px}.lock{opacity:.85;color:var(--locked)}
    .hidden{display:none !important}.row{display:flex;gap:12px;flex-wrap:wrap}
    input[type="text"],select{background:#0f1520;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:10px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid var(--border);border-radius:999px;background:#0c131d}
    .toast{position:fixed;right:16px;bottom:16px;background:#0c1a13;border:1px solid #124c2e;color:#b9f6ca;padding:12px 14px;border-radius:12px;box-shadow:0 10px 28px rgba(0,0,0,.35);display:none}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:18px;animation:fadeIn .2s ease;z-index:20}
    .overlay .sheet{max-width:860px;width:100%;background:var(--panel);border:1px solid var(--border);border-radius:18px;box-shadow:0 24px 64px rgba(0,0,0,.5);overflow:hidden}
    .sheet .head{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border);background:#0f1722}
    .sheet .body{padding:16px}.q{font-size:17px;margin-bottom:10px}.opts{display:grid;gap:10px}
    .opt{padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#0d1420;cursor:pointer;transition:background .2s ease,border-color .2s ease}
    .opt.correct{border-color:#1f9d6b;background:#0b1712}.opt.wrong{border-color:#8b1d30;background:#190f12}
    .exp{border-left:3px solid var(--accent);padding:8px 12px;margin-top:10px;background:#0f1622}
    .foot{display:flex;align-items:center;justify-content:space-between;margin-top:14px}
    .view{opacity:0;transform:translateY(8px);transition:opacity .25s ease,transform .25s ease}.view.show{opacity:1;transform:translateY(0)}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
  </style>

  <!-- Firebase (compat) for easy inline usage) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
</head>
<body>
<div class="wrap">

  <!-- Top bar (oculto no login) -->
  <div id="topBar" class="row hidden" style="align-items:center;justify-content:space-between;margin-bottom:16px">
    <div class="row" style="align-items:center">
      <h1>Duoplanning</h1>
    </div>
    <div class="row">
      <button id="btnConfig" class="btn ghost">âš™ï¸ <span class="meta" style="font-size:14px" data-i18n="settings">ConfiguraÃ§Ãµes</span></button>
      <button id="btnLogout" class="btn ghost hidden" data-i18n="logout">Sair</button>
    </div>
  </div>

  <!-- BRAND no login -->
  <div id="brandLogin" class="brand"><h1>Duoplanning</h1></div>

  <!-- Login -->
  <section id="viewLogin" class="panel view show">
    <h2 data-i18n="login_title">Entrar</h2>
    <p class="meta" data-i18n="login_tip">Digite seu nome para comeÃ§ar sua trilha.</p>
    <div class="row">
      <input id="inpName" type="text" placeholder="Seu nome" style="min-width:260px" />
      <button id="btnLogin" class="btn primary" data-i18n="start">ComeÃ§ar</button>
    </div>
    <div class="meta" style="margin-top:10px" data-i18n="login_hint">VocÃª comeÃ§arÃ¡ no nÃ­vel TÃ©cnico e desbloqueia os demais por XP.</div>
  </section>

  <!-- Dashboard -->
  <section id="viewDash" class="hidden view">
    <div class="grid cols-3">
      <div class="panel">
        <h3 id="hello">OlÃ¡, Jogador</h3>
        <div class="meta" id="roleMini">TÃ©cnico â€” Domina o bÃ¡sico do LPS</div>
        <div style="margin:10px 0 6px;display:flex;justify-content:space-between;align-items:center">
          <div class="meta"><span data-i18n="xp">XP</span>: <b id="xpNow">0</b> / <span id="xpGoal">1000</span></div>
          <div class="pill"><span id="streak">ğŸ”¥ 0</span><span class="meta" data-i18n="streak">streak</span></div>
        </div>
        <div class="xpbar"><i id="xpBar" style="width:0%"></i></div>
        <div class="row" style="margin-top:12px">
          <div class="pill">âš¡ <b id="energy">3</b> <span class="meta" data-i18n="energy">energia</span></div>
          <div class="pill">ğŸ† <span data-i18n="local_rank">Rank local</span>: <b id="rankMe">#1</b></div>
        </div>
      </div>

      <div class="panel">
        <h3 data-i18n="missions_hdr">MissÃµes</h3>
        <div class="row">
          <div class="pill" id="missionDailyPill">ğŸ¯ <b data-i18n="daily">Dia</b>: <span data-i18n="daily_desc">RefaÃ§a um quiz 100% (+20XP)</span></div>
          <div class="pill" id="missionWeekPill">ğŸ“… <b data-i18n="week">Semana</b>: <span data-i18n="week_desc">Concluir 3 mÃ³dulos (+100XP)</span> <span class="meta" id="weekProg">(0/3)</span></div>
        </div>
        <div class="meta" style="margin-top:10px" data-i18n="week_progress">Progresso semanal:</div>
        <div class="xpbar"><i id="weekBar" style="width:0%"></i></div>
      </div>

      <div class="panel">
        <h3 data-i18n="rank_hdr">Ranking (local)</h3>
        <div id="rankList" class="grid"></div>
      </div>
    </div>

    <div class="panel" style="margin-top:14px">
      <div class="row" style="align-items:center;justify-content:space-between">
        <h3 data-i18n="modules_hdr">MÃ³dulos</h3>
        <div class="pill" id="levelNowPill">ğŸ‘· TÃ©cnico</div>
      </div>
      <div class="meta" style="margin:6px 0" data-i18n="modules_hint">MÃ³dulos de outros nÃ­veis aparecem com cadeado ğŸ”’. Ganhe XP para desbloquear!</div>
      <div id="mods" class="grid cols-4" style="margin-top:12px"></div>
    </div>
  </section>

</div>

<!-- Quiz Overlay -->
<div id="quizOverlay" class="overlay">
  <div class="sheet">
    <div class="head">
      <div id="quizTitle">Quiz</div>
      <button id="btnCloseQuiz" class="btn ghost" data-i18n="close">Fechar</button>
    </div>
    <div class="body">
      <div class="q" id="qText">Pergunta</div>
      <div class="opts" id="qOpts"></div>
      <div id="qExplain" class="exp hidden"></div>
      <div class="foot">
        <div class="meta"><span id="qNum">1</span>/10</div>
        <button id="btnNext" class="btn primary" data-i18n="next">AvanÃ§ar</button>
      </div>
    </div>
  </div>
</div>

<!-- Config Overlay (agora com Idioma) -->
<div id="cfgOverlay" class="overlay">
  <div class="sheet">
    <div class="head">
      <div>âš™ï¸ <b data-i18n="settings">ConfiguraÃ§Ãµes</b></div>
      <button id="btnCloseCfg" class="btn ghost" data-i18n="close">Fechar</button>
    </div>
    <div class="body">
      <div class="grid cols-3">
        <div class="panel">
          <h3 data-i18n="appearance">AparÃªncia</h3>
          <div class="row" style="margin-top:8px">
            <label class="meta" for="selTheme" data-i18n="theme">Tema</label>
            <select id="selTheme">
              <option value="dark" data-i18n="theme_dark">Escuro</option>
              <option value="light" data-i18n="theme_light">Claro</option>
              <option value="auto" data-i18n="theme_auto">AutomÃ¡tico</option>
            </select>
          </div>
        </div>
        <div class="panel">
          <h3 data-i18n="language">Idioma</h3>
          <div class="row" style="margin-top:8px">
            <select id="langSel">
              <option value="pt">PortuguÃªs</option>
              <option value="en">English</option>
              <option value="es">EspaÃ±ol</option>
            </select>
          </div>
        </div>
        <div class="panel">
          <h3 data-i18n="effects">Efeitos</h3>
          <div class="row" style="margin-top:8px">
            <label><input type="checkbox" id="chkSound" /> <span class="meta" data-i18n="sound">Som de vitÃ³ria</span></label>
          </div>
          <div class="row">
            <label><input type="checkbox" id="chkConfetti" /> <span class="meta" data-i18n="confetti">Confete</span></label>
          </div>
        </div>
      </div>
      <div class="panel" style="margin-top:12px">
        <h3 data-i18n="danger_zone">Zona de risco</h3>
        <button id="btnReset" class="btn" style="margin-top:8px;background:#1f2937" data-i18n="reset">Resetar progresso</button>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast">Salvo</div>

<script>
// ====== I18N (PT/EN/ES) ======
const I18N = {
  pt: {login_title:"Entrar", login_tip:"Digite seu nome para comeÃ§ar sua trilha.", login_hint:"VocÃª comeÃ§arÃ¡ no nÃ­vel TÃ©cnico e desbloqueia os demais por XP.", start:"ComeÃ§ar", xp:"XP", streak:"streak", energy:"energia", local_rank:"Rank local", missions_hdr:"MissÃµes", daily:"Dia", daily_desc:"RefaÃ§a um quiz 100% (+20XP)", week:"Semana", week_desc:"Concluir 3 mÃ³dulos (+100XP)", week_progress:"Progresso semanal:", rank_hdr:"Ranking (local)", modules_hdr:"MÃ³dulos", modules_hint:"MÃ³dulos de outros nÃ­veis aparecem com cadeado ğŸ”’. Ganhe XP para desbloquear!", close:"Fechar", next:"AvanÃ§ar", welcome:"Bem-vindo(a)!", saved:"Salvo", module_done:"MÃ³dulo #{id} concluÃ­do: {score}/10", mission_daily_done:"MissÃ£o do Dia concluÃ­da! +20XP", mission_week_done:"MissÃ£o da Semana concluÃ­da! +100XP", settings:"ConfiguraÃ§Ãµes", appearance:"AparÃªncia", theme:"Tema", theme_dark:"Escuro", theme_light:"Claro", theme_auto:"AutomÃ¡tico", language:"Idioma", effects:"Efeitos", sound:"Som de vitÃ³ria", confetti:"Confete", danger_zone:"Zona de risco", reset:"Resetar progresso", logout:"Sair"},
  en: {login_title:"Sign in", login_tip:"Type your name to start your path.", login_hint:"You will start at the Technician level and unlock the others with XP.", start:"Start", xp:"XP", streak:"streak", energy:"energy", local_rank:"Local rank", missions_hdr:"Missions", daily:"Daily", daily_desc:"Retake a quiz with 100% (+20XP)", week:"Weekly", week_desc:"Complete 3 modules (+100XP)", week_progress:"Weekly progress:", rank_hdr:"Ranking (local)", modules_hdr:"Modules", modules_hint:"Modules from other levels show a ğŸ”’. Earn XP to unlock!", close:"Close", next:"Next", welcome:"Welcome!", saved:"Saved", module_done:"Module #{id} finished: {score}/10", mission_daily_done:"Daily Mission completed! +20XP", mission_week_done:"Weekly Mission completed! +100XP", settings:"Settings", appearance:"Appearance", theme:"Theme", theme_dark:"Dark", theme_light:"Light", theme_auto:"Auto", language:"Language", effects:"Effects", sound:"Victory sound", confetti:"Confetti", danger_zone:"Danger zone", reset:"Reset progress", logout:"Logout"},
  es: {login_title:"Iniciar sesiÃ³n", login_tip:"Escribe tu nombre para comenzar tu ruta.", login_hint:"ComenzarÃ¡s en el nivel TÃ©cnico y desbloquearÃ¡s los demÃ¡s con XP.", start:"Comenzar", xp:"XP", streak:"racha", energy:"energÃ­a", local_rank:"Ranking local", missions_hdr:"Misiones", daily:"DÃ­a", daily_desc:"Repite un quiz con 100% (+20XP)", week:"Semana", week_desc:"Completar 3 mÃ³dulos (+100XP)", week_progress:"Progreso semanal:", rank_hdr:"Ranking (local)", modules_hdr:"MÃ³dulos", modules_hint:"Los mÃ³dulos de otros niveles se muestran con candado ğŸ”’. Â¡Gana XP para desbloquearlos!", close:"Cerrar", next:"Siguiente", welcome:"Â¡Bienvenido(a)!", saved:"Guardado", module_done:"MÃ³dulo #{id} completado: {score}/10", mission_daily_done:"Â¡MisiÃ³n diaria completada! +20XP", mission_week_done:"Â¡MisiÃ³n semanal completada! +100XP", settings:"ConfiguraciÃ³n", appearance:"Apariencia", theme:"Tema", theme_dark:"Oscuro", theme_light:"Claro", theme_auto:"AutomÃ¡tico", language:"Idioma", effects:"Efectos", sound:"Sonido de victoria", confetti:"Confeti", danger_zone:"Zona de riesgo", reset:"Restablecer progreso", logout:"Salir"}
};
let lang = localStorage.getItem("duoplanning.lang") || "pt";
function t(key, vars={}){
  const dict = I18N[lang] || I18N.pt; let s = dict[key] || key;
  Object.entries(vars).forEach(([k,v])=>{ s = s.replaceAll("{"+k+"}", v); });
  return s;
}
function applyI18n() {
  const dict = I18N[lang] || I18N.pt;
  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.getAttribute("data-i18n");
    if (dict[key]) el.textContent = dict[key];
  });
  const ls = document.getElementById("langSel"); if (ls) ls.value = lang;
  document.documentElement.lang = lang === "pt" ? "pt-BR" : (lang === "es" ? "es-ES" : "en-US");
}

// ====== Settings (tema/som/confete) ======
const SETTINGS_KEY = "duoplanning.v42.settings";
let Settings = JSON.parse(localStorage.getItem(SETTINGS_KEY) || "null") || { theme:"dark", sound:true, confetti:true };
function saveSettings(){ localStorage.setItem(SETTINGS_KEY, JSON.stringify(Settings)); }
function applyTheme(){
  let theme = Settings.theme;
  if (theme==="auto"){ const prefersLight = window.matchMedia && window.matchMedia("(prefers-color-scheme: light)").matches; theme = prefersLight?"light":"dark"; }
  document.documentElement.setAttribute("data-theme", theme==="light"?"light":"dark");
}

// ====== Data ======
const LEVELS=[
  {id:"Tecnico",name:"TÃ©cnico",icon:"ğŸ‘·â€â™‚ï¸",minXP:0,nextXP:1000,desc:"Domina o bÃ¡sico do LPS"},
  {id:"Analista",name:"Analista",icon:"ğŸ‘¨â€ğŸ’»",minXP:1000,nextXP:3000,desc:"Organiza cronogramas e indicadores"},
  {id:"Especialista",name:"Especialista",icon:"ğŸ‘¨â€ğŸ”§",minXP:3000,nextXP:6000,desc:"Integra Engenharia e Obra"},
  {id:"Gerente",name:"Gerente/Diretor",icon:"ğŸ‘”",minXP:6000,nextXP:10000,desc:"Lidera com Lean e Performance"},
  {id:"Visionario",name:"VisionÃ¡rio",icon:"ğŸ”®",minXP:10000,nextXP:Infinity,desc:"Inova com IA, BIM e 5D"}
];
const XP_PER_LEVEL={Tecnico:30,Analista:40,Especialista:50,Gerente:60,Visionario:80};
const MODULES=[
  {id:1,nivel:"TÃ©cnico",titulo:"LPS â€“ Last Planner System"},
  {id:2,nivel:"TÃ©cnico",titulo:"Cronograma"},
  {id:3,nivel:"TÃ©cnico",titulo:"ProgramaÃ§Ã£o Semanal (WWP)"},
  {id:4,nivel:"TÃ©cnico",titulo:"EAP / AWP"},
  {id:5,nivel:"TÃ©cnico",titulo:"Folha Tarefa"},
  {id:6,nivel:"TÃ©cnico",titulo:"Produtos NotÃ¡veis"},
  {id:7,nivel:"TÃ©cnico",titulo:"Painel de Bordo"},
  {id:8,nivel:"TÃ©cnico",titulo:"Rundown / Curva S"},
  {id:9,nivel:"TÃ©cnico",titulo:"Ãndices e Produtividade"},
  {id:10,nivel:"TÃ©cnico",titulo:"ReuniÃµes Lean"},
  {id:11,nivel:"TÃ©cnico",titulo:"RestriÃ§Ãµes"},
  {id:12,nivel:"TÃ©cnico",titulo:"Waste Time"},

  {id:13,nivel:"Analista",titulo:"Linha de ProduÃ§Ã£o na Obra â€” EstratÃ©gias da IndÃºstria no Campo"},
  {id:14,nivel:"Analista",titulo:"Produtos NotÃ¡veis na PrÃ¡tica â€” Super MÃ³dulo"},
  {id:15,nivel:"Analista",titulo:"Folha-Tarefa & AderÃªncia DiÃ¡ria (PPC)"},
  {id:16,nivel:"Analista",titulo:"PPC, ICP e IPP â€” DiferenÃ§as e AplicaÃ§Ãµes"},
  {id:17,nivel:"Analista",titulo:"ProgramaÃ§Ã£o Semanal (WWP) AvanÃ§ada"},
  {id:18,nivel:"Analista",titulo:"GestÃ£o de RestriÃ§Ãµes AvanÃ§ada"},
  {id:19,nivel:"Analista",titulo:"Painel de Bordo â€” KPIs e DecisÃ£o"},
  {id:20,nivel:"Analista",titulo:"Curva S & Rundown â€” Leitura e AÃ§Ã£o"},
  {id:21,nivel:"Analista",titulo:"Linha de BalanÃ§o e Takt Time"},
  {id:22,nivel:"Analista",titulo:"Controle de Materiais â€” Tele Materiais"},

  {id:23,nivel:"Especialista",titulo:"IntegraÃ§Ã£o Engenhariaâ€“Planejamento"},
  {id:24,nivel:"Especialista",titulo:"AWP em Campo â€” EWP/CWP/IWP"},
  {id:25,nivel:"Especialista",titulo:"Cronograma FÃ­sico-Financeiro (Recursos & Custos)"},
  {id:26,nivel:"Especialista",titulo:"MediÃ§Ã£o e CritÃ©rios â€” Pesos e AvanÃ§o"},
  {id:27,nivel:"Especialista",titulo:"Comissionamento â€” Planilha Gerencial"},
  {id:28,nivel:"Especialista",titulo:"ProgramaÃ§Ã£o por Ãndices e Efetivo"},
  {id:29,nivel:"Especialista",titulo:"GestÃ£o Visual de Obra (Quadros)"},
  {id:30,nivel:"Especialista",titulo:"IÃ§amentos com Guindaste â€” Planejamento e InterferÃªncias"},
  {id:31,nivel:"Especialista",titulo:"TransferÃªncia de Obra â€” Entrada RÃ¡pida (SituaÃ§Ãµes Reais)"},
  {id:32,nivel:"Especialista",titulo:"SIMOVA â€” Rotinas de Campo e IntegraÃ§Ã£o"},

  {id:33,nivel:"Gerente/Diretor",titulo:"LideranÃ§a Lean & Performance"},
  {id:34,nivel:"Gerente/Diretor",titulo:"Curva S e Rundown: Visualizando a Performance"},
  {id:35,nivel:"Gerente/Diretor",titulo:"AWP com Cronograma Integrado â€” Recursos e Custos"},
  {id:36,nivel:"Gerente/Diretor",titulo:"GestÃ£o de PortfÃ³lio e Prioridades"},
  {id:37,nivel:"Gerente/Diretor",titulo:"EstratÃ©gias de ContrataÃ§Ã£o e MediÃ§Ã£o"},
  {id:38,nivel:"Gerente/Diretor",titulo:"Obeya â€” GovernanÃ§a de ReuniÃµes e DecisÃµes"},

  {id:39,nivel:"VisionÃ¡rio",titulo:"BIM 4D/5D â€” Planejamento Integrado"},
  {id:40,nivel:"VisionÃ¡rio",titulo:"IA & Power BI â€” SimulaÃ§Ãµes em Tempo Real"}
];
const QUIZZES={};
QUIZZES[1]=[{q:"Qual Ã© o objetivo principal do LPS?",opts:["Conectar planejamento Ã  execuÃ§Ã£o com compromisso real da equipe","Somente registrar tarefas no cronograma","Delegar o planejamento ao PMO"],ok:0,exp:"LPS alinha plano e execuÃ§Ã£o por meio de compromissos confiÃ¡veis e remoÃ§Ã£o de restriÃ§Ãµes."},{q:"PPC (Percent Plan Complete) mede:",opts:["AderÃªncia ao plano semanal","Produtividade de HH","AcurÃ¡cia de custos"],ok:0,exp:"PPC Ã© % de tarefas planejadas concluÃ­das na semana."},{q:"No LPS, as reuniÃµes de WWP servem para:",opts:["Planejar tarefas executÃ¡veis e tratar restriÃ§Ãµes","Aprovar aditivos","Revisar orÃ§amento anual"],ok:0,exp:"WWP prepara o trabalho removendo restriÃ§Ãµes e negociando compromissos."},{q:"Pull Planning Ã©:",opts:["Planejar de trÃ¡s pra frente por marcos","Planejar sÃ³ com o passado","Planejar por recursos financeiros"],ok:0,exp:"Inicia dos marcos e puxa entregas necessÃ¡rias para atingi-los."},{q:"Indicador de causa de nÃ£o cumprimento:",opts:["Motivos de falha (causas)","Horas extras","Volume de compras"],ok:0,exp:"Registrar causas (material, acesso, projeto, clima...) fecha o ciclo PDCA."},{q:"Para elevar o PPC de forma sustentÃ¡vel:",opts:["Tratar restriÃ§Ãµes no lookahead","Aumentar pressÃ£o por meta","Reduzir escopo sem registrar"],ok:0,exp:"Olhar Ã  frente e remover restriÃ§Ãµes aumenta confiabilidade."},{q:"No LPS, â€˜tarefa pronta para executarâ€™ significa:",opts:["Sem restriÃ§Ãµes de material, projeto, frente e seguranÃ§a","Apenas com material no canteiro","Somente com equipe alocada"],ok:0,exp:"CritÃ©rios de prontidÃ£o devem ser atendidos antes do compromisso."},{q:"O papel da SupervisÃ£o no LPS:",opts:["Assumir compromissos e gerir variaÃ§Ãµes","Somente reportar ao planejamento","Aprovar notas fiscais"],ok:0,exp:"Compromisso Ã© de quem executa; supervisÃ£o Ã© chave."},{q:"ICP e IPP estÃ£o relacionados a:",opts:["Confiabilidade do plano e prontidÃ£o","Custo unitÃ¡rio","Produtividade de guindaste"],ok:0,exp:"ICP mede causas de nÃ£o cumprimento; IPP mede prontidÃ£o."},{q:"Resultado esperado com LPS maduro:",opts:["Menos variabilidade e mais fluxo","Mais burocracia","Menos transparÃªncia"],ok:0,exp:"LPS estabiliza o sistema e aumenta previsibilidade."}];
QUIZZES[2]=[{q:"Cronograma nÃ­vel 1-2 normalmente representa:",opts:["Macro fases e marcos","Recursos hora a hora","Ordens de compra"],ok:0,exp:"NÃ­veis altos mostram visÃ£o executiva de fases e marcos."},{q:"Caminho CrÃ­tico Ã©:",opts:["SequÃªncia de atividades que define a duraÃ§Ã£o do projeto","Atividades com maior custo","Tarefas com maior HH"],ok:0,exp:"Atraso no caminho crÃ­tico atrasa o fim."},{q:"Relacionamento mais usado em obra:",opts:["Finish-to-Start (FS)","Start-to-Start (SS)","Finish-to-Finish (FF)"],ok:0,exp:"FS garante ordem lÃ³gica bÃ¡sica entre tarefas."},{q:"CalendÃ¡rios no cronograma servem para:",opts:["Regras de trabalho (turnos/feriados)","CÃ¡lculo de custo","MediÃ§Ã£o de qualidade"],ok:0,exp:"Fundamentais para duraÃ§Ã£o realista."},{q:"Baseline Ã©:",opts:["Linha de referÃªncia de prazo/custo","RelatÃ³rio diÃ¡rio","Matriz de riscos"],ok:0,exp:"Permite medir desvios do plano aprovado."},{q:"Nivelamento de recursos visa:",opts:["Suavizar picos de alocaÃ§Ã£o","Reduzir custo por si sÃ³","Eliminar caminho crÃ­tico"],ok:0,exp:"Evita sobrecarga e ociosidade."},{q:"Lead e Lag significam:",opts:["Adiantamento e atraso entre tarefas","Tipos de marcos","Modos de calendÃ¡rio"],ok:0,exp:"Ajustam a sobreposiÃ§Ã£o/espera entre atividades."},{q:"WBS (EAP) no cronograma:",opts:["Estrutura hierÃ¡rquica do escopo","Lista de materiais","Fluxo de caixa"],ok:0,exp:"A base do sequenciamento e mediÃ§Ã£o."},{q:"Marco (milestone) possui:",opts:["DuraÃ§Ã£o zero","DuraÃ§Ã£o fixa de 1 dia","HH mÃ¡ximo"],ok:0,exp:"Marcos nÃ£o consomem duraÃ§Ã£o."},{q:"No controle semanal, o cronograma deve:",opts:["Refletir a realidade rapidamente","Ser alterado mensalmente","Permanecer estÃ¡tico"],ok:0,exp:"AtualizaÃ§Ã£o Ã¡gil aumenta precisÃ£o da gestÃ£o."}];
QUIZZES[3]=[{q:"WWP define:",opts:["Plano executÃ¡vel da semana","Plano financeiro do mÃªs","Plano de compras do trimestre"],ok:0,exp:"WWP detalha tarefas que atenderam critÃ©rios de prontidÃ£o."},{q:"Para montar WWP, Ã© essencial:",opts:["Eng. liberada, materiais e frente de trabalho","Apenas equipe","Apenas guindaste"],ok:0,exp:"Sem restriÃ§Ãµes pendentes."},{q:"Sequenciamento semanal deve considerar:",opts:["InterferÃªncias e seguranÃ§a","Somente distÃ¢ncia fÃ­sica","Somente custo"],ok:0,exp:"Evitar atividades sobrepostas inseguras."},{q:"PPC semanal serve para:",opts:["Avaliar aderÃªncia e causas de falha","Medir custo","Medir satisfaÃ§Ã£o"],ok:0,exp:"Permite aprendizado e ajuste."},{q:"Lookahead tÃ­pico:",opts:["2â€“6 semanas Ã  frente","1 dia","1 ano"],ok:0,exp:"Janela para remover restriÃ§Ãµes."},{q:"Ao mudar prioridade no meio da semana:",opts:["Replanejar com equipe envolvida","Deixar como estÃ¡","Apagar tarefas"],ok:0,exp:"Replanejamento colaborativo mantÃ©m compromisso."},{q:"Entrega de materiais no WWP:",opts:["JIT (no tempo certo) quando possÃ­vel","Sempre antecipada demais","Sem coordenaÃ§Ã£o"],ok:0,exp:"Evita estoque e espera."},{q:"CritÃ©rio de pronto:",opts:["Check de seguranÃ§a, projeto, material, acesso","Apenas seguranÃ§a","Apenas projeto"],ok:0,exp:"Checklist reduz variabilidade."},{q:"Quadro visual semanal ajuda a:",opts:["TransparÃªncia e foco","Aumentar burocracia","Diminuir comunicaÃ§Ã£o"],ok:0,exp:"Suporte Ã  gestÃ£o Ã  vista."},{q:"ReuniÃ£o diÃ¡ria de 15 min na semana:",opts:["Alinhar desvios e riscos","Aprovar folhas de pagamento","Debater orÃ§amento anual"],ok:0,exp:"Ritmo curto fecha o ciclo PDCA."}];
QUIZZES[4]=[{q:"Qual Ã© o principal objetivo da EAP?",opts:["Estruturar o escopo em partes controlÃ¡veis","Listar materiais","Criar Ã­ndices de produtividade"],ok:0,exp:"A EAP quebra o escopo em pacotes gerenciÃ¡veis."},{q:"No AWP, o que representa o CWP?",opts:["Construction Work Package","Contract Work Package","Cost Work Package"],ok:0,exp:"CWP = pacote de trabalho de construÃ§Ã£o."},{type:"order",q:"Qual Ã© a sequÃªncia correta entre os pacotes AWP?",items:["EWP","CWP","IWP"],correctOrder:["EWP","CWP","IWP"],exp:"Engenharia â†’ ConstruÃ§Ã£o â†’ InstalaÃ§Ã£o."},{q:"Quem normalmente detalha o IWP?",opts:["Planejamento + SupervisÃ£o de Campo","Financeiro","SeguranÃ§a"],ok:0,exp:"Planejamento com a supervisÃ£o definem escopo executÃ¡vel."},{q:"A EAP contribui para:",opts:["Rastreabilidade e controle","Aumentar burocracia","Dificultar mediÃ§Ãµes"],ok:0,exp:"Padroniza controle e integra com Ã­ndices/custos."},{q:"AtÃ© que nÃ­vel a EAP deve ir?",opts:["AtÃ© suportar controle de prazo e custo","Sempre atÃ© 7 nÃ­veis","Apenas 2 nÃ­veis"],ok:0,exp:"Profundidade suficiente para gestÃ£o eficaz."},{q:"BenefÃ­cio de liberaÃ§Ã£o progressiva no AWP:",opts:["Fluxo contÃ­nuo de frentes","Mais retrabalho","Menos visibilidade"],ok:0,exp:"Libera Ã¡reas/zonas por marcos de engenharia/suprimentos."},{q:"Quando o AWP deve comeÃ§ar a ser aplicado?",opts:["No planejamento da engenharia","Somente na obra","ApÃ³s o comissionamento"],ok:0,exp:"ComeÃ§a na engenharia para orquestrar o fluxo fim-a-fim."},{q:"O IWP deve conter:",opts:["InstruÃ§Ãµes, materiais, desenhos e requisitos de seguranÃ§a","Apenas custo","Somente cronograma"],ok:0,exp:"ConteÃºdo completo para execuÃ§Ã£o segura e rastreÃ¡vel."},{q:"Uma boa EAP facilita a integraÃ§Ã£o com:",opts:["Cronograma, Ã­ndices e mediÃ§Ãµes","Somente planilhas financeiras","Apenas reuniÃµes"],ok:0,exp:"Conecta planejamento, custos e fÃ­sico."}];
QUIZZES[5]=[{q:"Folha-Tarefa serve para:",opts:["Registrar aderÃªncia diÃ¡ria e bloqueios","Emitir pedido de compra","Apresentar orÃ§amento ao cliente"],ok:0,exp:"Base para PPC, causas e produtividade."},{q:"Campo essencial na Folha-Tarefa:",opts:["Equipe, HH, atividade e status","NÃºmero de nota fiscal","CÃ³digo do fornecedor"],ok:0,exp:"Garante rastreio e mediÃ§Ã£o diÃ¡ria."},{q:"AderÃªncia diÃ¡ria idealmente Ã©:",opts:[">= 85% com causas mapeadas","50%","100% sem explicar falhas"],ok:0,exp:"Mais que a meta, importa entender desvios."},{q:"A Folha-Tarefa conecta-se com:",opts:["WWP/PPC e Painel de Bordo","Somente RH","Somente compras"],ok:0,exp:"Integra execuÃ§Ã£o com indicadores."},{q:"â€˜Tarefa concluÃ­daâ€™ significa:",opts:["Atende critÃ©rios de qualidade e seguranÃ§a","Entrada no sistema","Guincho liberado"],ok:0,exp:"Fechamento requer critÃ©rios objetivos."},{q:"Para robustez, a Folha-Tarefa deve:",opts:["Ter campos padronizados e explicativos","Ser livre e sem padrÃ£o","Ser textual somente"],ok:0,exp:"PadronizaÃ§Ã£o evita ambiguidade."},{q:"Bloqueios recorrentes devem gerar:",opts:["Plano de aÃ§Ã£o e dono","Arquivo morto","Apenas comentÃ¡rio"],ok:0,exp:"Fechar o loop com responsÃ¡veis e prazo."},{q:"Quando registrar a tarefa:",opts:["No dia, durante ou ao final do turno","Somente no fim da semana","Somente no inÃ­cio do projeto"],ok:0,exp:"Timeliness aumenta qualidade do dado."},{q:"MediÃ§Ã£o HH Real vem de:",opts:["Apontamentos confiÃ¡veis","Estimativas mensais","CÃ¡lculo fixo"],ok:0,exp:"Apontamento de campo Ã© base de verdade."},{q:"Dados da Folha-Tarefa alimentam:",opts:["Curva S e produtividade","Apenas folha de pagamento","Apenas relatÃ³rio fotogrÃ¡fico"],ok:0,exp:"Transformam execuÃ§Ã£o em indicador."}];
QUIZZES[6]=[{q:"Produtos NotÃ¡veis Ã©:",opts:["Matriz de Ã­ndices por disciplina/serviÃ§o","Lista de compras","DiÃ¡rio de obra"],ok:0,exp:"Define HH/ton, HH/m, etc., por item."},{q:"Exemplo de Ã­ndice real:",opts:["200 hh/ton para tubulaÃ§Ã£o","20 kg/h para cimento","10 mÂ³/h para concreto estrutural"],ok:0,exp:"Ãndices reais alimentam planejamento."},{q:"Para cabos, um Ã­ndice comum Ã©:",opts:["â‰ˆ0,25 hh/m","5 hh/m","2 hh/m"],ok:0,exp:"Usado para planejar e medir produtividade."},{q:"Planilha deve conter:",opts:["Previsto vs Real e variaÃ§Ã£o","Somente previsto","Somente real"],ok:0,exp:"Permite anÃ¡lise de desempenho."},{q:"Ãndices calibram:",opts:["Planejamento, alocaÃ§Ã£o e metas","Somente compras","Somente RH"],ok:0,exp:"Transformam engenharia em horas e custo."},{q:"Desvio negativo indica:",opts:["Produtividade abaixo do esperado","Adiantamento","Erro de mediÃ§Ã£o do cliente"],ok:0,exp:"AÃ§Ã£o corretiva e causa-raiz."},{q:"Para simular cenÃ¡rios:",opts:["Use filtros por tag/Ã¡rea/serviÃ§o","Apenas total do projeto","Apenas HH mÃ©dio"],ok:0,exp:"Granularidade dÃ¡ precisÃ£o."},{q:"Ãndices devem ser:",opts:["Atualizados e validados em campo","Fixos para sempre","Secretos"],ok:0,exp:"Melhoram com aprendizado."},{q:"IntegraÃ§Ã£o com Painel:",opts:["KPIs de variaÃ§Ã£o e hit-rate","Apenas fotos","Apenas custos"],ok:0,exp:"Torna a gestÃ£o visual acionÃ¡vel."},{q:"Ao revisar Ã­ndices:",opts:["Considere mix de equipes e frentes","Ignore clima","Ignore logÃ­stica"],ok:0,exp:"Contexto muda produtividade."}];
QUIZZES[7]=[{q:"Painel de Bordo bom mostra:",opts:["KPIs claros e atualizados","Somente planilhas","Textos longos"],ok:0,exp:"Foco em decisÃµes rÃ¡pidas."},{q:"KPI de produÃ§Ã£o tÃ­pico:",opts:["% avanÃ§o, variaÃ§Ã£o p.p., PPC","Taxa de cÃ¢mbio","Rotatividade anual"],ok:0,exp:"Reflete ritmo e aderÃªncia."},{q:"AtualizaÃ§Ã£o do painel:",opts:["Semanal como padrÃ£o","Anual","A cada 6 meses"],ok:0,exp:"Alimenta reaÃ§Ã£o rÃ¡pida."},{q:"Alertas visuais servem para:",opts:["Chamar atenÃ§Ã£o a desvios","Enfeitar","Substituir dados"],ok:0,exp:"Prioriza a aÃ§Ã£o."},{q:"Boa prÃ¡tica de dashboard:",opts:["Fonte Ãºnica de verdade (SSOT)","VÃ¡rias versÃµes paralelas","Planilhas isoladas"],ok:0,exp:"Evitar divergÃªncias."},{q:"Para decisÃµes de curto prazo:",opts:["KPIs de fluxo e gargalos","Somente custo acumulado","Somente satisfaÃ§Ã£o anual"],ok:0,exp:"Mostra onde atacar."},{q:"Drill-down Ã©:",opts:["Explorar detalhe por disciplina/Ã¡rea","Exportar para PDF","Apagar histÃ³rico"],ok:0,exp:"Permite investigaÃ§Ã£o rÃ¡pida."},{q:"Painel conecta-se a:",opts:["Folha-Tarefa, WWP, Curva S","Somente RH","Somente compras"],ok:0,exp:"Integra execuÃ§Ã£o e controle."},{q:"DefiniÃ§Ã£o de meta de PPC:",opts:["Clara, com responsÃ¡vel e prazo","'Melhorar PPC um dia'","Sem dono"],ok:0,exp:"Meta sem dono nÃ£o anda."},{q:"Layout eficaz usa:",opts:["Poucas cores e hierarquia visual","Muitas cores fortes","Sombras exageradas"],ok:0,exp:"Design ajuda a leitura."}];
QUIZZES[8]=[{q:"O objetivo do Rundown Ã©:",opts:["Comparar avanÃ§o semanal planejado x realizado","Registrar custos","Organizar equipes"],ok:0,exp:"Mostra ritmo semanal e alimenta a Curva S."},{q:"Base de cÃ¡lculo da Curva S:",opts:["Pesos fÃ­sicos (HH, ton, m)","Somente custo","Horas extras"],ok:0,exp:"Pesos fÃ­sicos por atividade."},{type:"calc",q:"PRÃTICA â€” Real 35% e Plano 40%: desvio =",answer:-5,tolerance:0.5,unit:"%",exp:"Desvio = Real âˆ’ Plano = âˆ’5 p.p. (atraso)."},{q:"FrequÃªncia tÃ­pica do Rundown:",opts:["Semanal","Mensal","Anual"],ok:0,exp:"Semanal para reaÃ§Ã£o rÃ¡pida."},{q:"Vantagem da Curva S:",opts:["Visualizar tendÃªncias e desvios","Calcular HH/dia","Organizar contratos"],ok:0,exp:"Evidencia aderÃªncia ao plano."},{type:"calc",q:"Se na semana o Plano=8% e o Real=10%, variaÃ§Ã£o semanal =",answer:2,tolerance:0.2,unit:"p.p.",exp:"10 âˆ’ 8 = +2 p.p. (adiantado)."},{q:"Para Curva S confiÃ¡vel, Ã© essencial:",opts:["CritÃ©rios de mediÃ§Ã£o claros","Somente horas apontadas","Apenas quantidade de equipes"],ok:0,exp:"Defina pesos, marcos e periodicidade."},{type:"text",q:"PRÃTICA â€” Diga um motivo tÃ­pico para desvio negativo:",answerText:["falta de material","restriÃ§Ã£o","atraso de projeto","acesso","gargalo"],exp:"RestriÃ§Ã£o nÃ£o tratada Ã© causa comum."},{type:"order",q:"Ordem lÃ³gica de leitura:",items:["Rundown semanal","Curva S acumulada","Plano de aÃ§Ã£o"],correctOrder:["Rundown semanal","Curva S acumulada","Plano de aÃ§Ã£o"],exp:"Ritmo â†’ tendÃªncia â†’ aÃ§Ã£o."},{q:"Indicador derivado Ãºtil:",opts:["Desvio acumulado p.p.","NÂº de e-mails","Horas de reuniÃ£o"],ok:0,exp:"Mostra magnitude do atraso/adianto."}];
QUIZZES[9]=[{q:"Produtividade Ã©:",opts:["Quantidade produzida por HH","HH por custo","Custo por item"],ok:0,exp:"Base para metas e comparaÃ§Ãµes."},{q:"Para comparar equipes, padronize:",opts:["Unidades e critÃ©rios de mediÃ§Ã£o","Somente nomes das equipes","Foto do serviÃ§o"],ok:0,exp:"Sem padronizaÃ§Ã£o nÃ£o hÃ¡ anÃ¡lise."},{q:"Ãndice 200 hh/ton significa:",opts:["Horas para montar 1 tonelada","Toneladas por hora","Custo por tonelada"],ok:0,exp:"Converte escopo em HH planejado."},{q:"Ao cair produtividade:",opts:["Investigue causas-raiz (gargalo, logÃ­stica, clima...)","Ignore porque recupera depois","Cobre metas sem dados"],ok:0,exp:"AnÃ¡lise tÃ©cnica orienta aÃ§Ã£o."},{q:"Medida rolling semanal ajuda a:",opts:["Suavizar ruÃ­do e ver tendÃªncia","Aumentar ruÃ­do","Esconder desvios"],ok:0,exp:"MÃ©dia mÃ³vel estabiliza leitura."},{q:"Benchmark interno deve:",opts:["Comparar Ã¡reas e frentes similares","Misturar tudo","Ser anual apenas"],ok:0,exp:"ComparÃ¡vel Ã© o que importa."},{q:"Ãndices devem ser usados para:",opts:["Planejar e medir, nÃ£o punir","Punir","Arquivar"],ok:0,exp:"Evita jogo de nÃºmeros."},{q:"Para cabos, rendimento tÃ­pico:",opts:["0,25 hh/m (exemplo)","2 hh/m","5 hh/m"],ok:0,exp:"Exemplo usual em elÃ©trica."},{q:"VisualizaÃ§Ã£o ideal:",opts:["Run charts e dispersÃ£o","Texto corrido","Pizza sempre"],ok:0,exp:"Mostram relaÃ§Ã£o e tendÃªncia."},{q:"Meta deve ser:",opts:["AlcanÃ§Ã¡vel e negociada com execuÃ§Ã£o","Definida isoladamente","Secreta"],ok:0,exp:"Acordo aumenta adesÃ£o."}];
QUIZZES[10]=[{q:"ReuniÃ£o diÃ¡ria (daily) ideal dura:",opts:["10â€“15 minutos","60 minutos","90 minutos"],ok:0,exp:"RÃ¡pida, foco no desvio e aÃ§Ã£o."},{q:"Obeya Ã©:",opts:["Sala/ritual de gestÃ£o com dados visuais","Software de cronograma","Ferramenta de compras"],ok:0,exp:"TransparÃªncia e ritmo de decisÃ£o."},{q:"Em reuniÃµes Lean, cada aÃ§Ã£o deve ter:",opts:["Dono e prazo","Somente descriÃ§Ã£o","SÃ³ prioridade"],ok:0,exp:"Sem dono nÃ£o sai do papel."},{q:"Ritmo de reuniÃµes recomendado:",opts:["DiÃ¡rias, semanais e mensais com pauta definida","Somente mensais","Quando der"],ok:0,exp:"CadÃªncia gera previsibilidade."},{q:"Pauta de WWP inclui:",opts:["RemoÃ§Ã£o de restriÃ§Ãµes e compromisso","AprovaÃ§Ã£o de faturas","Planejamento anual"],ok:0,exp:"Foco na prontidÃ£o e compromisso."},{q:"Quadro de aÃ§Ãµes deve mostrar:",opts:["Status, dono, prazo e impacto","Somente tÃ­tulo","Somente data"],ok:0,exp:"GestÃ£o Ã  vista acelera execuÃ§Ã£o."},{q:"ReuniÃ£o eficaz comeÃ§a com:",opts:["Objetivo claro e dados atualizados","Check-in social longo","Slides extensos"],ok:0,exp:"Clareza e dados sustentam decisÃµes."},{q:"Ao surgir conflito de prioridade:",opts:["Negociar com base em marcos e restriÃ§Ãµes","Impor pela hierarquia","Ignorar"],ok:0,exp:"Fluxo global > otimizaÃ§Ã£o local."},{q:"Tempo de reuniÃ£o deve ser usado para:",opts:["Decidir e remover impedimentos","Atualizar status manual","Contar histÃ³rias"],ok:0,exp:"DecisÃ£o e desbloqueio criam valor."},{q:"Follow-up pÃ³s reuniÃ£o:",opts:["Resumo + checklist de aÃ§Ãµes","Somente ata tÃ©cnica","Nada Ã© necessÃ¡rio"],ok:0,exp:"Garante accountability."}];
QUIZZES[11]=[{q:"RestriÃ§Ã£o Ã©:",opts:["Qualquer fator que impede execuÃ§Ã£o","Somente falta de material","Somente chuva"],ok:0,exp:"Pode ser projeto, acesso, seguranÃ§a, liberaÃ§Ã£o etc."},{q:"Planilha de restriÃ§Ãµes deve ter:",opts:["DescriÃ§Ã£o, responsÃ¡vel e prazo","Somente descriÃ§Ã£o","Somente data"],ok:0,exp:"Garante ciclo de remoÃ§Ã£o."},{q:"Fonte tÃ­pica de restriÃ§Ãµes:",opts:["Engenharia, suprimentos e acesso","Sorriso da equipe","EscritÃ³rio central"],ok:0,exp:"Principais gargalos do campo."},{q:"Lookahead serve para:",opts:["Antecipar e tratar restriÃ§Ãµes futuras","Gerar notas fiscais","Planejar fÃ©rias"],ok:0,exp:"Prepara a execuÃ§Ã£o."},{q:"Sem dono definido:",opts:["RestriÃ§Ã£o tende a permanecer","Resolve mais rÃ¡pido","Fica mais barata"],ok:0,exp:"ResponsabilizaÃ§Ã£o acelera."},{q:"Sinal verde no quadro significa:",opts:["RestriÃ§Ã£o removida","Nova restriÃ§Ã£o","AÃ§Ã£o atrasada"],ok:0,exp:"SemÃ¡foro visual simples."},{q:"Causa raiz ajuda a:",opts:["Evitar recorrÃªncia","Culpar pessoas","Eliminar relatÃ³rios"],ok:0,exp:"Aprendizado organizacional."},{q:"IntegraÃ§Ã£o com WWP:",opts:["Tarefas sÃ³ entram 'prontas' (sem restriÃ§Ãµes)","Entram mesmo com bloqueio","NÃ£o se relacionam"],ok:0,exp:"ProntidÃ£o Ã© prÃ©-requisito."},{q:"Priorizar restriÃ§Ãµes por:",opts:["Impacto no caminho crÃ­tico/ritmo","Ordem alfabÃ©tica","Quem grita mais"],ok:0,exp:"Ataca o que mais afeta o fluxo."},{q:"Ferramenta Ãºtil para restriÃ§Ãµes:",opts:["Quadro Kanban/semÃ¡foro","Bate-papo informal","E-mail solto"],ok:0,exp:"GestÃ£o visual acelera."}];
QUIZZES[12]=[{q:"â€˜Waste Timeâ€™ no canteiro Ã©:",opts:["Tempo perdido por falta de planejamento/logÃ­stica","Tempo de descanso legal","Tempo de almoÃ§o"],ok:0,exp:"Reduzir WT aumenta produtividade."},{q:"Exemplo de WT:",opts:["Equipe aguardando material/liberaÃ§Ã£o","ExecuÃ§Ã£o com todas frentes prontas","Tarefa finalizada no prazo"],ok:0,exp:"Aguardo Ã© perda de fluxo."},{q:"Ferramenta para reduzir WT:",opts:["Tele Materiais / gestÃ£o de entregas","Apenas cobranÃ§a","E-mail em massa"],ok:0,exp:"Sistema puxa materiais no tempo certo."},{q:"Mapa de fluxo ajuda a:",opts:["Identificar gargalos e esperas","Criar mais passos","Otimizar localmente"],ok:0,exp:"VisÃ£o ponta a ponta."},{q:"MediÃ§Ã£o de WT pode usar:",opts:["% do tempo Ãºtil vs parado","Somente HH total","Somente custo"],ok:0,exp:"Quantificar para reduzir."},{q:"Layout de canteiro impacta:",opts:["LogÃ­stica e WT","Somente seguranÃ§a","Nada"],ok:0,exp:"Fluxos menores = menos espera."},{q:"PadronizaÃ§Ã£o (5S) reduz:",opts:["Procuras e retrabalhos","Custo fixo","Tempo de reuniÃ£o"],ok:0,exp:"OrganizaÃ§Ã£o elimina perda."},{q:"Planejamento de iÃ§amento evita:",opts:["InterferÃªncia e espera de Ã¡reas vizinhas","Qualidade","Contrato"],ok:0,exp:"Evitar bloqueios por sobreposiÃ§Ã£o."},{q:"Para sustentar ganhos:",opts:["Rotina de revisÃ£o de WT e aÃ§Ãµes","Somente campanha Ãºnica","Ignorar dados"],ok:0,exp:"Ciclo contÃ­nuo de melhoria."},{q:"Indicador Ãºtil de WT:",opts:["Tempo perdido por causa e Ã¡rea","Quantidade de e-mails","NÂº de reuniÃµes"],ok:0,exp:"Direciona ataque aos maiores vilÃµes."}];
const QUIZ_FALLBACK=[
  {q:"Pergunta genÃ©rica 1",opts:["A","B","C"],ok:0,exp:"ExplicaÃ§Ã£o."},
  {q:"Pergunta genÃ©rica 2",opts:["A","B","C"],ok:1,exp:"ExplicaÃ§Ã£o."},
  {q:"Pergunta genÃ©rica 3",opts:["A","B","C"],ok:2,exp:"ExplicaÃ§Ã£o."},
  {q:"Pergunta genÃ©rica 4",opts:["A","B","C"],ok:0,exp:"ExplicaÃ§Ã£o."},
  {q:"Pergunta genÃ©rica 5",opts:["A","B","C"],ok:1,exp:"ExplicaÃ§Ã£o."},
  {q:"Pergunta genÃ©rica 6",opts:["A","B","C"],ok:0,exp:"ExplicaÃ§Ã£o."},
  {q:"Pergunta genÃ©rica 7",opts:["A","B","C"],ok:2,exp:"ExplicaÃ§Ã£o."},
  {q:"Pergunta genÃ©rica 8",opts:["A","B","C"],ok:1,exp:"ExplicaÃ§Ã£o."},
  {q:"Pergunta genÃ©rica 9",opts:["A","B","C"],ok:2,exp:"ExplicaÃ§Ã£o."},
  {q:"Pergunta genÃ©rica 10",opts:["A","B","C"],ok:0,exp:"ExplicaÃ§Ã£o."},
];

// ====== State ======
const STATE_KEY="duoplanning.v42.state";
let S=JSON.parse(localStorage.getItem(STATE_KEY) || "null")||{name:"",xp:0,energy:3,levelId:"Tecnico",streak:0,lastLoginDay:"",cleared:{},week:{startIso:"",modulesDone:0},dailyDoneOn:"",rank:[{name:"VocÃª",xp:0},{name:"Alice",xp:560},{name:"Bruno",xp:320}]};
function save(){ localStorage.setItem(STATE_KEY, JSON.stringify(S)); }


// ====== Online Leaderboard (Firebase Firestore) ======
// 1) Preencha sua configuraÃ§Ã£o abaixo (Projeto Firebase â†’ Config Web App)
const FB_CONFIG = {
  apiKey: "PASTE_YOUR_API_KEY",
  authDomain: "PASTE_YOUR_AUTH_DOMAIN",
  projectId: "PASTE_YOUR_PROJECT_ID",
  // opcional: storageBucket, messagingSenderId, appId
};
let Online = {enabled:false, ready:false, last:[], unsub:null};
// ====== Online init with Anonymous Auth ======
Online.status = "offline"; // 'online' | 'offline' | 'loading'
function updateRankHeader(){
  const hdr = document.querySelector('[data-i18n="rank_hdr"]');
  if (!hdr) return;
  if (Online.enabled && Online.ready) hdr.textContent = (lang==='en'?'Ranking (online)':'Ranking (online)');
  else if (Online.enabled && !Online.ready) hdr.textContent = (lang==='en'?'Ranking (loading...)':'Ranking (carregando...)');
  else hdr.textContent = (lang==='en'?'Ranking (local)':'Ranking (local)');
}
function OnlineInit(){
  if (!Online.enabled || Online.ready) { updateRankHeader(); return; }
  try{
    Online.status = "loading";
    updateRankHeader();
    firebase.auth().onAuthStateChanged((user)=>{
      if (user) {
        Online.user = user;
        onlineUpsertScore();
        onlineSubscribeLeaderboard(20);
      } else {
        firebase.auth().signInAnonymously().catch(e=>console.warn('Anon auth error', e));
      }
    });
    // kickoff auth if not already
    if (!firebase.auth().currentUser) firebase.auth().signInAnonymously().catch(()=>{});
  }catch(e){ console.warn("OnlineInit error:", e); }
}

try{
  if (FB_CONFIG.apiKey && FB_CONFIG.projectId) {
    firebase.initializeApp(FB_CONFIG);
    Online.db = firebase.firestore();
    Online.enabled = true;
  }
}catch(e){ console.warn("Firebase init error:", e); Online.enabled=false; }

function uid(){
  const KEY="duoplanning.uid";
  let id=localStorage.getItem(KEY);
  if(!id){ id = Math.random().toString(36).slice(2) + Date.now().toString(36); localStorage.setItem(KEY,id); }
  return id;
}

function onlineUpsertScore(){
  if(!Online.enabled || !Online.db) return;
  const L=currentLevel();
  const docId = uid();
  Online.db.collection("leaderboard").doc(docId).set({
    name: S.name || "Jogador",
    xp: S.xp || 0,
    levelId: S.levelId || "Tecnico",
    levelName: L.name,
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  }, {merge:true}).catch(err=>console.warn("Upsert score error:", err));
}

function onlineSubscribeLeaderboard(limit=20){
  if(!Online.enabled || !Online.db) return;
  if(Online.unsub) try{ Online.unsub(); }catch(e){}
  Online.unsub = Online.db.collection("leaderboard")
    .orderBy("xp","desc")
    .limit(limit)
    .onSnapshot(snap=>{
      Online.last = [];
      snap.forEach(doc=> Online.last.push(doc.data()));
      Online.ready = true; Online.status = "online";
      renderDash();  // re-render ranking ao chegar dados
    }, err=>{
      console.warn("Leaderboard subscribe error:", err);
      Online.ready = false; Online.status = "offline";
      renderDash();
    });
}
// ====== Helpers ======
function todayKey(){const d=new Date();return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0")}
function mondayOfThisWeekISO(){const d=new Date();const day=d.getDay();const diff=(day===0?-6:1-day);const m=new Date(d);m.setDate(d.getDate()+diff);return m.toISOString().slice(0,10)}
function currentLevel(){let L=LEVELS[0];for(const lv of LEVELS){if(S.xp>=lv.minXP)L=lv}S.levelId=L.id;return L}
function addXP(v){S.xp+=v;toast("+"+v+" "+t("xp"));try{ if(Settings.sound) document.getElementById("audioWin").play().catch(()=>{}) }catch(e){}; if(Settings.confetti){confetti({particleCount:120,spread:65,origin:{y:.6}})} save(); onlineUpsertScore(); renderDash();}
function toast(msg){const tEl=document.getElementById("toast");tEl.textContent=msg;tEl.style.display="block";setTimeout(()=>tEl.style.display="none",1800)}

// ====== Render ======
function renderDash(){
  const L=currentLevel();
  document.getElementById("hello").textContent = (lang==="en"?"Hello, ":"Hola, ") && (lang==="pt" ? `OlÃ¡, ${S.name||"Jogador"}` : (lang==="en"?`Hello, ${S.name||"Player"}`:`Hola, ${S.name||"Jugador"}`));
  document.getElementById("roleMini").textContent=`${L.name} â€” ${L.desc}`;
  document.getElementById("levelNowPill").textContent=`${L.icon} ${L.name}`;
  document.getElementById("xpNow").textContent=S.xp;
  document.getElementById("xpGoal").textContent=isFinite(L.nextXP)?L.nextXP:"âˆ";
  const pct=isFinite(L.nextXP)?Math.max(0,Math.min(100,100*(S.xp-L.minXP)/(L.nextXP-L.minXP))):100;
  document.getElementById("xpBar").style.width=pct+"%";
  document.getElementById("streak").textContent="ğŸ”¥ "+S.streak;
  document.getElementById("energy").textContent=S.energy;

  const mondayIso=mondayOfThisWeekISO();
  if(S.week.startIso!==mondayIso){S.week.startIso=mondayIso;S.week.modulesDone=0;save()}
  document.getElementById("weekProg").textContent=`(${S.week.modulesDone}/3)`;
  document.getElementById("weekBar").style.width=Math.min(100,(S.week.modulesDone/3)*100)+"%";

  const mods=document.getElementById("mods");mods.innerHTML="";
  MODULES.forEach(m=>{
    const locked=(m.nivel!==L.name);const score=S.cleared[m.id]||0;
    const icon=(m.nivel==='TÃ©cnico'?'ğŸ‘·':m.nivel==='Analista'?'ğŸ‘¨â€ğŸ’»':m.nivel==='Especialista'?'ğŸ‘¨â€ğŸ”§':m.nivel==='Gerente/Diretor'?'ğŸ‘”':'ğŸ”®');
    const el=document.createElement("div");el.className="mod";
    const lockedText = lang==='en'?'Locked':(lang==='es'?'Bloqueado':'bloqueado');
    const notStarted = lang==='en'?'Not started':(lang==='es'?'No iniciado':'Ainda nÃ£o iniciado');
    const bestLabel = lang==='en'?'best:':(lang==='es'?'mejor:':'melhor:');
    el.innerHTML=`<div class="left"><div class="lvl">${icon}</div><div><div><b>${m.titulo}</b> <span class="meta">#${m.id} Â· ${m.nivel}</span></div><div class="meta">${locked?'<span class="lock">ğŸ”’ '+lockedText+'</span>':(score?bestLabel+` ${score}/10`:notStarted)}</div></div></div><div>${score?`<span class="meta">${bestLabel} ${score}/10</span>`:""}<button class="btn" ${locked?'disabled':''} data-mod="${m.id}">${locked?'ğŸ”’':'â–¶ï¸ '+(lang==='en'?'Start':(lang==='es'?'Iniciar':'Iniciar'))}</button></div>`;
    mods.appendChild(el);
  });
  document.querySelectorAll('[data-mod]').forEach(b=>b.onclick=(e)=>{startQuiz(+e.currentTarget.getAttribute('data-mod'))});

  
  // Render ranking (online se disponÃ­vel, senÃ£o local) + medalhas + barra
  const rankDiv = document.getElementById("rankList");
  if (rankDiv) {
    // Header status
    updateRankHeader();
    // Refresh button
    rankDiv.innerHTML = "";
    const btn = document.createElement("button");
    btn.className = "btn ghost";
    btn.style.marginBottom = "8px";
    btn.textContent = (lang==='en'?'Refresh ranking':'Atualizar ranking');
    btn.onclick = ()=>{ if (Online.enabled){ onlineSubscribeLeaderboard(20);} renderDash(); };
    rankDiv.appendChild(btn);

    const data = (Online.enabled && Online.ready && Online.last.length) ? Online.last : (S.rank || []);
    if (!data.length) {
      const item = document.createElement("div");
      item.className = "meta";
      item.textContent = (Online.enabled? (lang==='en'?'Loading ranking...':'Carregando ranking...') : (lang==='en'?'No ranking data':'Sem dados de ranking.'));
      rankDiv.appendChild(item);
    } else {
      data.slice(0,20).forEach((r,i)=>{
        const item = document.createElement("div");
        item.className = "mod";
        item.style.display = "flex";
        item.style.flexDirection = "column";
        const name = r.name || "Jogador";
        const xp = r.xp || 0;

        // Medalha para top 3
        const medal = i===0?'ğŸ¥‡':(i===1?'ğŸ¥ˆ':(i===2?'ğŸ¥‰':'#'+(i+1)));
        // Estimar nÃ­vel por XP
        let Lname='TÃ©cnico', Lmin=0, Lnext=1000, Licon='ğŸ‘·';
        try{
          let Ltmp = LEVELS[0];
          for (const lv of LEVELS){ if (xp>=lv.minXP) Ltmp = lv; }
          Lname = Ltmp.name; Lmin = Ltmp.minXP; Lnext = isFinite(Ltmp.nextXP)?Ltmp.nextXP:(xp||1);
          Licon = (Lname==='TÃ©cnico'?'ğŸ‘·':Lname==='Analista'?'ğŸ‘¨â€ğŸ’»':Lname==='Especialista'?'ğŸ‘¨â€ğŸ”§':Lname==='Gerente/Diretor'?'ğŸ‘”':'ğŸ”®');
        }catch(e){/* noop */}
        const pct = Math.max(0, Math.min(100, (100*(xp - Lmin)/((Lnext - Lmin)||1))));

        item.innerHTML = `
          <div style="display:flex;justify-content:space-between;align-items:center;width:100%">
            <div><b>${medal}</b> ${Licon} ${name} <span class="meta">(${Lname})</span></div>
            <div class="meta">${xp} XP</div>
          </div>
          <div class="xpbar" style="margin-top:6px"><i style="width:${pct}%"></i></div>
        `;
        rankDiv.appendChild(item);
      });
    }
  }
applyI18n();
}

// ====== Login ======
function doLogin(){
  const name=(document.getElementById("inpName").value||"").trim()||(lang==="en"?"Player":(lang==="es"?"Jugador":"Jogador"));
  S.name=name;S.levelId="Tecnico";
  const tk=todayKey();
  if(S.lastLoginDay!==tk){S.streak=(S.lastLoginDay && ((new Date(tk)-new Date(S.lastLoginDay))===86400000))?(S.streak+1):1;S.lastLoginDay=tk}
  save(); OnlineInit(); onlineUpsertScore();
  // hide brand + login, show top bar + dash
  document.getElementById("brandLogin").classList.add("hidden");
  document.getElementById("viewLogin").classList.add("hidden");
  document.getElementById("topBar").classList.remove("hidden");
  const dash=document.getElementById("viewDash");
  dash.classList.remove("hidden"); setTimeout(()=>dash.classList.add("show"),0);
  document.getElementById("btnLogout").classList.remove("hidden");
  renderDash();
  toast(t("welcome"));
}
document.getElementById("btnLogin").onclick=doLogin;
document.getElementById("btnLogout").onclick=()=>{localStorage.removeItem(STATE_KEY);location.reload()};

// ====== Quiz ======
let curQuiz=null,curIdx=0,curScore=0,curModId=0;
function pickTen(qs){if(qs.length<=10)return qs.slice();const arr=qs.slice();const out=[];while(out.length<10&&arr.length){const i=Math.floor(Math.random()*arr.length);out.push(arr.splice(i,1)[0])}return out}
function startQuiz(modId){curModId=modId;const raw=QUIZZES[modId]||QUIZZES[13]||QUIZ_FALLBACK;curQuiz=pickTen(raw);curIdx=0;curScore=0;document.getElementById("quizTitle").textContent=`${t("modules_hdr")} #${modId}`;document.getElementById("quizOverlay").style.display="flex";document.getElementById("qExplain").classList.add("hidden");renderQuestion()}
function closeQuiz(){document.getElementById("quizOverlay").style.display="none"}
document.getElementById("btnCloseQuiz").onclick=closeQuiz;
function renderQuestion(){
  const q=curQuiz[curIdx];document.getElementById("qNum").textContent=(curIdx+1);document.getElementById("qText").textContent=q.q;
  const box=document.getElementById("qOpts");const exp=document.getElementById("qExplain");exp.classList.add("hidden");exp.textContent="";box.innerHTML="";
  const L=currentLevel();const XP_HIT=XP_PER_LEVEL[L.id]||30;
  function addOpt(label,isCorrect){const div=document.createElement("div");div.className="opt";div.textContent=label;div.onclick=()=>{if(isCorrect){div.classList.add("correct");curScore++;addXP(XP_HIT)}else{div.classList.add("wrong")}exp.textContent=q.exp||"";exp.classList.remove("hidden");box.querySelectorAll(".opt").forEach(o=>o.style.pointerEvents="none")};box.appendChild(div)}
  if(!q.type||q.type==="multi-choice"){q.opts.forEach((o,i)=>addOpt(o,i===q.ok))}
  else if(q.type==="text"){const inp=document.createElement("input");inp.type="text";inp.placeholder=lang==="en"?"Type your answer...":(lang==="es"?"Escribe tu respuesta...":"Digite sua resposta...");box.appendChild(inp);const btn=document.createElement("button");btn.className="btn";btn.textContent="Validar";btn.onclick=()=>{const val=(inp.value||"").toLowerCase().trim();const arr=(q.answerText||[]).map(x=>x.toLowerCase());const ok=arr.some(x=>val.includes(x));if(ok){addXP(XP_HIT);exp.textContent=q.exp||"Correto."}else{exp.textContent=q.exp||"Revise o conceito."}exp.classList.remove("hidden");btn.disabled=true};box.appendChild(btn)}
  else if(q.type==="calc"){const inp=document.createElement("input");inp.type="number";inp.step="any";inp.placeholder=lang==="en"?"Value":"Valor";box.appendChild(inp);const btn=document.createElement("button");btn.className="btn";btn.textContent="Calcular";btn.onclick=()=>{const v=parseFloat(inp.value);const tol=q.tolerance??0;const ok=Math.abs(v-q.answer)<=tol;if(ok){addXP(XP_HIT);exp.textContent=q.exp||"Certo!"}else{exp.textContent=`Esperado â‰ˆ ${q.answer}${q.unit?(" "+q.unit):""}. ${q.exp||""}`}exp.classList.remove("hidden");btn.disabled=true};box.appendChild(btn)}
  else if(q.type==="order"){const src=q.items.slice();const ul=document.createElement("div");ul.className="row";src.forEach((it)=>{const p=document.createElement("div");p.className="pill";p.draggable=true;p.textContent=it;p.ondragstart=(e)=>{e.dataTransfer.setData("text/plain",it)};ul.appendChild(p)});const target=document.createElement("div");target.className="row";target.style.minHeight="42px";target.ondragover=(e)=>e.preventDefault();target.ondrop=(e)=>{e.preventDefault();const t=e.dataTransfer.getData("text/plain");const el=Array.from(ul.children).find(x=>x.textContent===t);if(el){target.appendChild(el)}};box.appendChild(ul);box.appendChild(target);const btn=document.createElement("button");btn.className="btn";btn.textContent="Validar";btn.onclick=()=>{const arr=Array.from(target.children).map(x=>x.textContent);const ok=JSON.stringify(arr)===JSON.stringify(q.correctOrder);if(ok){addXP(XP_HIT);exp.textContent=q.exp||"Certo!"}else{exp.textContent=`Ordem esperada: ${q.correctOrder.join(" â†’ ")}. ${q.exp||""}`}exp.classList.remove("hidden");btn.disabled=true};box.appendChild(btn)}
}
document.getElementById("btnNext").onclick=()=>{if(!curQuiz)return;if(curIdx<curQuiz.length-1){curIdx++;renderQuestion()}else{const best=S.cleared[curModId]||0;if(curScore>best)S.cleared[curModId]=curScore;const tk=todayKey();if(curScore===10&&S.dailyDoneOn!==tk){S.dailyDoneOn=tk;addXP(20);toast(t("mission_daily_done"))}const mondayIso=mondayOfThisWeekISO();if(S.week.startIso!==mondayIso){S.week.startIso=mondayIso;S.week.modulesDone=0}S.week.modulesDone=Math.min(3,S.week.modulesDone+1);if(S.week.modulesDone===3){addXP(100);toast(t("mission_week_done"))}save();toast(t("module_done",{id:String(curModId),score:String(curScore)}));closeQuiz();renderDash()}};

// ====== Config handlers ======
document.getElementById("btnConfig").onclick=()=>{
  document.getElementById("cfgOverlay").style.display="flex";
  document.getElementById("selTheme").value=Settings.theme;
  document.getElementById("chkSound").checked=!!Settings.sound;
  document.getElementById("chkConfetti").checked=!!Settings.confetti;
  const ls=document.getElementById("langSel"); ls.value=lang;
  applyI18n();
};
document.getElementById("btnCloseCfg").onclick=()=>{document.getElementById("cfgOverlay").style.display="none"};
document.getElementById("selTheme").addEventListener("change",(e)=>{Settings.theme=e.target.value;saveSettings();applyTheme()});
document.getElementById("chkSound").addEventListener("change",(e)=>{Settings.sound=!!e.target.checked;saveSettings()});
document.getElementById("chkConfetti").addEventListener("change",(e)=>{Settings.confetti=!!e.target.checked;saveSettings()});
document.getElementById("langSel").addEventListener("change",(e)=>{
  lang = e.target.value;
  localStorage.setItem("duoplanning.lang", lang);
  applyI18n(); renderDash();
});
document.getElementById("btnReset").onclick=()=>{
  localStorage.removeItem(STATE_KEY);
  S={name:"",xp:0,energy:3,levelId:"Tecnico",streak:0,lastLoginDay:"",cleared:{},week:{startIso:"",modulesDone:0},dailyDoneOn:"",rank:[{name:"VocÃª",xp:0},{name:"Alice",xp:560},{name:"Bruno",xp:320}]};
  save(); toast(t("saved")); renderDash();
};

// ====== Init ======
applyTheme();
applyI18n();
if(S.name){ OnlineInit(); onlineUpsertScore();
  document.getElementById("brandLogin").classList.add("hidden");
  document.getElementById("viewLogin").classList.add("hidden");
  document.getElementById("topBar").classList.remove("hidden");
  const dash=document.getElementById("viewDash");
  dash.classList.remove("hidden"); setTimeout(()=>dash.classList.add("show"),0);
  document.getElementById("btnLogout").classList.remove("hidden");
  renderDash();
}
</script>
</body>
</html>
